{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.find.js\";\nimport \"core-js/modules/esnext.iterator.flat-map.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nimport \"core-js/modules/esnext.iterator.some.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { format } from \"date-fns\";\nimport axios from \"axios\";\nimport jsPDF from 'jspdf';\nimport 'jspdf-autotable';\nimport ExcelJS from 'exceljs';\nimport { API_URL } from '@/config'; // Importer API_URL\n\nexport default {\n  data() {\n    return {\n      colorMapping: {\n        1: {\n          name: 'Client',\n          class: 'bg-orange-400'\n        },\n        2: {\n          name: 'Prévision',\n          class: 'bg-yellow-400'\n        },\n        // Corrigé de 'yellow' à 'yellow-400'\n        3: {\n          name: 'Voyage',\n          class: 'bg-sky-400'\n        },\n        // Corrigé de 'Voyage' à 'Voyage'\n        4: {\n          name: 'Férié/Congé',\n          class: 'bg-blue-300'\n        },\n        5: {\n          name: 'Formation',\n          class: 'bg-blue-500'\n        },\n        6: {\n          name: 'Récupération',\n          class: 'bg-red-400'\n        },\n        7: {\n          name: 'Congé maladie',\n          class: 'bg-purple-600'\n        },\n        8: {\n          name: 'Université',\n          class: 'bg-sky-600'\n        },\n        9: {\n          name: 'Avant Vente',\n          class: 'bg-teal-300'\n        },\n        // Corrigé de 'teal' à 'teal-300'\n        default: {\n          name: 'Inconnu',\n          class: 'bg-blue-400'\n        }\n      },\n      isExportModalOpen: false,\n      currentYear: new Date().getFullYear(),\n      currentMonth: new Date().getMonth(),\n      monthsOfYear: [\"Janvier\", \"Février\", \"Mars\", \"Avril\", \"Mai\", \"Juin\", \"Juillet\", \"Août\", \"Septembre\", \"Octobre\", \"Novembre\", \"Décembre\"],\n      currentDay: new Date().getDate(),\n      viewMode: \"year\",\n      //  month or year\n      resources: [],\n      events: [],\n      selectedClientId: \"\",\n      clientSearch: \"\",\n      // Barre de recherche pour le filtre\n      clients: [],\n      // Assurez-vous que `clients` contient les données de vos clients\n      joursFeries: [],\n      agences: [],\n      bangeResults: [],\n      isBANGEModalOpen: false,\n      bangeStartDate: \"\",\n      bangeEndDate: \"\",\n      searchStartDate: \"\",\n      searchEndDate: \"\",\n      tnfSearchResults: [],\n      isEventModalOpen: false,\n      selectedEvent: {},\n      hoveredEvent: null,\n      hoveredDay: null,\n      selectedClientColor: \"\",\n      comment: \"\",\n      startDate: \"\",\n      endDate: \"\",\n      user_id: null,\n      selectedPays: \"\"\n    };\n  },\n  computed: {\n    filteredClients() {\n      return this.clients.filter(client => client.nom.toLowerCase().includes(this.clientSearch.toLowerCase()));\n    },\n    displayPeriod() {\n      if (this.viewMode === \"month\") {\n        const firstDayOfMonth = new Date(this.currentYear, this.currentMonth, 1);\n        return format(firstDayOfMonth, \"MMMM yyyy\");\n      } else if (this.viewMode === \"year\") {\n        const firstDayOfYear = new Date(this.currentYear, 0, 1);\n        return format(firstDayOfYear, \"yyyy\");\n      } else {\n        return `${this.currentYear}`;\n      }\n    },\n    formattedJoursFeries() {\n      // Format the public holidays to only include the date in 'yyyy-MM-dd' format\n      return this.joursFeries.map(jourFerie => ({\n        date: format(new Date(jourFerie.date_ferie), \"yyyy-MM-dd\"),\n        // Keep the date format\n        name: jourFerie.nom_ferie\n      }));\n    },\n    periodDays() {\n      return this.viewMode === \"month\" ? this.getDaysInMonth() : this.getDaysInYear();\n    },\n    filteredResources() {\n      let filtered = this.resources;\n\n      // Filter by client name\n      if (this.clientSearch) {\n        // Find resource IDs that have interventions matching the client name\n        const matchingResourceIds = new Set(this.events.filter(event => event.clientName.toLowerCase().includes(this.clientSearch.toLowerCase())).map(event => event.resourceId));\n\n        // Filter resources based on matching IDs\n        filtered = this.resources.filter(resource => matchingResourceIds.has(resource.id));\n      }\n\n      // Filter by date range\n      if (this.searchStartDate && this.searchEndDate) {\n        const startDate = new Date(this.searchStartDate);\n        const endDate = new Date(this.searchEndDate);\n        filtered = filtered.filter(resource => {\n          const tnfDays = this.getTNFDaysInPeriod(resource, startDate, endDate);\n          return tnfDays.length > 0;\n        });\n      }\n\n      // Filter by selected agency\n      if (this.selectedPays) {\n        filtered = filtered.filter(resource => resource.agence && resource.agence.pays === this.selectedPays);\n      }\n      return filtered;\n    },\n    // Nouvelle propriété calculée pour récupérer les événements par jour et ressource\n    filteredEventsByDay() {\n      const filteredEvents = {};\n      this.filteredResources.forEach(resource => {\n        filteredEvents[resource.name] = {};\n        const days = this.viewMode === \"month\" ? this.getDaysInMonth() : this.getDaysInYear().flatMap(month => month.days);\n        days.forEach(day => {\n          const dayDate = new Date(this.currentYear, this.viewMode === \"month\" ? this.currentMonth : 0, typeof day === \"number\" ? day : day.day);\n          filteredEvents[resource.name][day] = this.events.filter(event => event.resource === resource.name && this.isEventOnDay(event, dayDate));\n        });\n      });\n      return filteredEvents;\n    },\n    statisticsByColor() {\n      return this.calculateStatisticsByColor();\n    }\n  },\n  watch: {\n    searchStartDate() {\n      this.updateView();\n    },\n    searchEndDate() {\n      this.updateView();\n    },\n    clientSearch() {\n      this.updateView();\n    },\n    selectedPays() {\n      this.fetchJoursFeries();\n      this.fetchResourcesAndEvents();\n    }\n  },\n  mounted() {\n    this.fetchResourcesAndEvents();\n    this.fetchClients();\n    this.fetchJoursFeries();\n    this.fetchAgences();\n  },\n  methods: {\n    openExportModal() {\n      this.isExportModalOpen = true;\n    },\n    closeExportModal() {\n      this.isExportModalOpen = false;\n      this.endDate = \"\";\n      this.startDate = \"\";\n    },\n    exportToXLSX() {\n      const workbook = new ExcelJS.Workbook();\n      const worksheet = workbook.addWorksheet('Interventions');\n\n      // Définir les colonnes\n      worksheet.columns = [{\n        header: 'Numero',\n        key: 'Numero',\n        width: 10\n      }, {\n        header: 'Ressource',\n        key: 'Ressource',\n        width: 20\n      }, {\n        header: 'Date de debut',\n        key: 'Date_de_debut',\n        width: 20\n      }, {\n        header: 'Date de fin',\n        key: 'Date_de_fin',\n        width: 20\n      }, {\n        header: 'Client',\n        key: 'Client',\n        width: 20\n      }, {\n        header: 'Commentaire',\n        key: 'Commentaire',\n        width: 30\n      }, {\n        header: 'Abbreviation',\n        key: 'Abbreviation',\n        width: 15\n      }];\n\n      // Vérifier si les dates sont sélectionnées\n      let filteredEvents = this.events;\n      if (this.startDate && this.endDate) {\n        filteredEvents = this.events.filter(event => {\n          const eventStartDate = new Date(event.startDate);\n          const eventEndDate = new Date(event.endDate);\n          const start = new Date(this.startDate);\n          const end = new Date(this.endDate);\n          return eventStartDate >= start && eventEndDate <= end;\n        });\n      }\n\n      // Ajouter les données\n      filteredEvents.forEach((event, index) => {\n        worksheet.addRow({\n          Numero: index + 1,\n          Ressource: event.resource,\n          Date_de_debut: event.startDate,\n          Date_de_fin: event.endDate,\n          Client: event.clientName,\n          Commentaire: event.name,\n          Abbreviation: event.clientAbbreviation\n        });\n      });\n\n      // Styliser l'entête avec un gradient violet et rose\n      const headerRow = worksheet.getRow(1);\n      headerRow.eachCell(cell => {\n        cell.fill = {\n          type: 'gradient',\n          gradient: 'angle',\n          degree: 0,\n          stops: [{\n            position: 0,\n            color: {\n              argb: 'FF69B4'\n            }\n          },\n          // Rose\n          {\n            position: 1,\n            color: {\n              argb: '800080'\n            }\n          } // Violet\n          ]\n        };\n        cell.font = {\n          color: {\n            argb: 'FFFFFF'\n          },\n          bold: true\n        };\n        cell.alignment = {\n          horizontal: 'center',\n          vertical: 'middle'\n        };\n      });\n\n      // Obtenir la date actuelle\n      const currentDate = new Date().toLocaleDateString().replace(/\\//g, '-');\n\n      // Enregistrer le fichier avec la date d'exportation dans le nom\n      workbook.xlsx.writeBuffer().then(data => {\n        const blob = new Blob([data], {\n          type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n        });\n        const link = document.createElement('a');\n        link.href = URL.createObjectURL(blob);\n        link.download = `Staffings_${currentDate}.xlsx`;\n        link.click();\n        URL.revokeObjectURL(link.href);\n      });\n\n      // Fermer le modal après l'exportation\n      this.closeExportModal();\n    },\n    exportToPDF() {\n      // Définir le format A4\n      const doc = new jsPDF({\n        orientation: 'portrait',\n        unit: 'mm',\n        format: [210, 297]\n      });\n\n      // Définir les colonnes et les données\n      const columns = [{\n        header: 'Numero',\n        dataKey: 'Numero'\n      }, {\n        header: 'Ressource',\n        dataKey: 'Ressource'\n      }, {\n        header: 'Date de debut',\n        dataKey: 'Date_de_debut'\n      }, {\n        header: 'Date de fin',\n        dataKey: 'Date_de_fin'\n      }, {\n        header: 'Client',\n        dataKey: 'Client'\n      }, {\n        header: 'Commentaire',\n        dataKey: 'Commentaire'\n      }, {\n        header: 'Abbreviation',\n        dataKey: 'Abbreviation'\n      }];\n\n      // Vérifier si les dates sont sélectionnées\n      let filteredEvents = this.events;\n      if (this.startDate && this.endDate) {\n        filteredEvents = this.events.filter(event => {\n          const eventStartDate = new Date(event.startDate);\n          const eventEndDate = new Date(event.endDate);\n          const start = new Date(this.startDate);\n          const end = new Date(this.endDate);\n          return eventStartDate >= start && eventEndDate <= end;\n        });\n      }\n      const data = filteredEvents.map((event, index) => ({\n        Numero: index + 1,\n        Ressource: event.resource,\n        Date_de_debut: event.startDate,\n        Date_de_fin: event.endDate,\n        Client: event.clientName,\n        Commentaire: event.name,\n        Abbreviation: event.clientAbbreviation\n      }));\n\n      // Ajouter le tableau au PDF\n      doc.autoTable({\n        head: [columns.map(col => col.header)],\n        body: data.map(row => columns.map(col => row[col.dataKey])),\n        startY: 20,\n        styles: {\n          fillColor: [240, 240, 240],\n          // Blanc légèrement gris\n          textColor: [0, 0, 0],\n          // Noir\n          fontStyle: 'normal',\n          halign: 'center',\n          valign: 'middle',\n          cellPadding: 5\n        },\n        headStyles: {\n          fillColor: [128, 0, 128],\n          // Violet\n          textColor: [255, 255, 255],\n          fontStyle: 'bold',\n          halign: 'center',\n          valign: 'middle',\n          cellPadding: 5\n        }\n      });\n\n      // Obtenir la date actuelle\n      const currentDate = new Date().toLocaleDateString().replace(/\\//g, '-');\n\n      // Enregistrer le PDF avec la date d'exportation dans le nom\n      doc.save(`Staffings_${currentDate}.pdf`);\n\n      // Fermer le modal après l'exportation\n      this.closeExportModal();\n    },\n    async fetchAgences() {\n      try {\n        const response = await axios.get(`${API_URL}/agences`, {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n          }\n        });\n        this.agences = response.data.agences;\n      } catch (error) {\n        console.error(\"Erreur lors de la récupération des agences:\", error);\n      }\n    },\n    filterInterventionsByClientName(clientName) {\n      const lowerCaseClientName = clientName.toLowerCase();\n      return this.events.filter(event => event.clientName.toLowerCase().includes(lowerCaseClientName));\n    },\n    calculateBANGE(startDate, endDate) {\n      const start = new Date(startDate);\n      const end = new Date(endDate);\n      let totalBANGE = 0;\n      let currentWeekStart = new Date(start);\n      while (currentWeekStart <= end) {\n        const weekEnd = new Date(currentWeekStart);\n        weekEnd.setDate(currentWeekStart.getDate() + 6);\n        let totalTNF = 0;\n        let workingDays = 0;\n        for (let d = new Date(currentWeekStart); d <= weekEnd; d.setDate(d.getDate() + 1)) {\n          const {\n            isWeekend\n          } = this.isWeekend(d.getDate(), d.getMonth());\n          const isHoliday = this.isJourFerie(d.getDate(), d.getMonth());\n          if (isHoliday) {\n            continue;\n          }\n          if (isWeekend) {\n            console.log(\"holiday\");\n          } else {\n            workingDays++;\n            this.resources.forEach(resource => {\n              const events = this.getEventsForMonth(resource.name, d.getMonth(), d.getDate());\n              if (!events || events.length === 0) {\n                totalTNF++;\n              }\n            });\n          }\n        }\n        const etp = workingDays > 0 ? Math.min(workingDays, 5) : 0; // Limite à 5 jours max\n        const weeklyBANGE = etp > 0 ? (totalTNF / etp).toFixed(1) : 0;\n        totalBANGE += parseFloat(weeklyBANGE);\n        currentWeekStart.setDate(currentWeekStart.getDate() + 7); // Passe à la semaine suivante\n      }\n      return totalBANGE.toFixed(1); // Retourne le total formaté\n    },\n    calculateAndDisplayBANGE() {\n      if (this.bangeStartDate && this.bangeEndDate) {\n        const bangeResult = this.calculateBANGE(this.bangeStartDate, this.bangeEndDate);\n        this.bangeResults.push({\n          date: `${this.bangeStartDate} - ${this.bangeEndDate}`,\n          bange: bangeResult\n        });\n        this.isBANGEModalOpen = true;\n      } else {\n        alert(\"Veuillez sélectionner une date de début et une date de fin.\");\n      }\n    },\n    closeBANGEModal() {\n      this.isBANGEModalOpen = false;\n      this.bangeStartDate = \"\";\n      this.bangeEndDate = \"\";\n      this.bangeResults = [];\n    },\n    getDayAbbreviation(date) {\n      const days = [\"dim\", \"lun\", \"mar\", \"mer\", \"jeu\", \"ven\", \"sam\"];\n      return days[date.getDay()];\n    },\n    isWednesday(day, monthIndex) {\n      const date = new Date(this.currentYear, monthIndex, day);\n      return date.getDay() === 3; // 3 représente mercredi (0 = dimanche, 1 = lundi, etc.)\n    },\n    // Modifiez la méthode getWeeklyBANGE pour prendre en compte le monthIndex\n    getWeeklyBANGE(day, monthIndex = null) {\n      // Détermine la date de la semaine à partir du jour donné\n      const initialDate = new Date(this.currentYear, monthIndex !== null ? monthIndex : this.currentMonth, day);\n\n      // Ajuste le début de la semaine au lundi\n      const weekStart = new Date(initialDate);\n      const dayOfWeek = weekStart.getDay(); // 0 = Dimanche, 1 = Lundi, ..., 6 = Samedi\n      const offsetToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // Ajustement vers le lundi\n      weekStart.setDate(weekStart.getDate() + offsetToMonday);\n\n      // Fixe la fin de la semaine au vendredi (4 jours après lundi)\n      const weekEnd = new Date(weekStart);\n      weekEnd.setDate(weekStart.getDate() + 4);\n      let totalTNF = 0; // Compteur des jours sans événements\n      let workingDays = 0; // Compteur des jours ouvrables\n\n      // Parcourt chaque jour de la semaine (lundi à vendredi)\n      for (let d = new Date(weekStart); d <= weekEnd; d.setDate(d.getDate() + 1)) {\n        const isHoliday = this.isJourFerie(d.getDate(), d.getMonth()); // Vérifie si le jour est férié\n\n        if (isHoliday) {\n          // Ignore les jours fériés\n          continue;\n        }\n\n        // Tous les jours de lundi à vendredi sont considérés ouvrables ici\n        workingDays++; // Incrémente les jours ouvrables\n\n        // Vérifie les événements pour chaque ressource\n        this.resources.forEach(resource => {\n          const events = this.getEventsForMonth(resource.name, d.getMonth(), d.getDate());\n          if (!events || events.length === 0) {\n            // Si aucun événement trouvé, incrémente TNF\n            totalTNF++;\n          }\n        });\n      }\n\n      // Calcule l'ETP (équivalent temps plein), limité à un maximum de 5 jours par semaine\n      const etp = workingDays > 0 ? Math.min(workingDays, 5) : 0;\n\n      // Calcule le ratio BANGE pour la semaine\n      const bange = etp > 0 ? (totalTNF / etp).toFixed(1) : 0;\n\n      // Retourne le BANGE pour la semaine\n      return {\n        bange\n      };\n    },\n    // Nouvelle méthode pour calculer le BANGE mensuel\n    getMonthlyBANGE() {\n      const start = new Date(this.currentYear, this.currentMonth, 1);\n      const end = new Date(this.currentYear, this.currentMonth + 1, 0);\n      let totalBANGE = 0;\n      let currentWeekStart = new Date(start);\n      while (currentWeekStart <= end) {\n        const weekEnd = new Date(currentWeekStart);\n        weekEnd.setDate(currentWeekStart.getDate() + 6);\n        let totalTNF = 0;\n        let workingDays = 0;\n        for (let d = new Date(currentWeekStart); d <= weekEnd; d.setDate(d.getDate() + 1)) {\n          const dayOfWeek = d.getDay();\n          if (dayOfWeek !== 0 && dayOfWeek !== 6 && !this.isJourFerie(d.getDate(), d.getMonth())) {\n            workingDays++;\n            this.resources.forEach(resource => {\n              const events = this.getEventsForMonth(resource.name, d.getMonth(), d.getDate());\n              if (!events || events.length === 0) {\n                totalTNF++;\n              }\n            });\n          }\n        }\n        const etp = workingDays > 0 ? Math.min(workingDays, 5) : 0;\n        const weeklyBANGE = etp > 0 ? (totalTNF / etp).toFixed(1) : 0;\n        totalBANGE += parseFloat(weeklyBANGE);\n        currentWeekStart.setDate(currentWeekStart.getDate() + 7);\n      }\n      return totalBANGE.toFixed(1);\n    },\n    getJourFerieName(day, monthIndex = null) {\n      const date = new Date(this.currentYear, monthIndex !== null ? monthIndex : this.currentMonth, typeof day === \"number\" ? day : new Date(day).getDate());\n      const formattedDate = format(date, \"yyyy-MM-dd\");\n      const jourFerie = this.formattedJoursFeries.find(jour => jour.date === formattedDate);\n      return jourFerie ? jourFerie.name : \"Férié\";\n    },\n    isJourFerie(day, monthIndex = null) {\n      const date = new Date(this.currentYear, monthIndex !== null ? monthIndex : this.currentMonth, typeof day === \"number\" ? day : new Date(day).getDate());\n      const formattedDate = format(date, \"yyyy-MM-dd\");\n      const isHoliday = this.formattedJoursFeries.some(jour => jour.date === formattedDate);\n      return isHoliday;\n    },\n    calculateBusinessDays(startDate, endDate) {\n      let count = 0;\n      const currentDate = new Date(startDate);\n      while (currentDate <= endDate) {\n        const dayOfWeek = currentDate.getDay();\n        if (dayOfWeek !== 0 && dayOfWeek !== 6) {\n          count++;\n        }\n        currentDate.setDate(currentDate.getDate() + 1);\n      }\n      return count;\n    },\n    showComment(event, day) {\n      this.hoveredEvent = event;\n      this.hoveredDay = day;\n    },\n    hideComment() {\n      this.hoveredEvent = null;\n      this.hoveredDay = null;\n    },\n    // Remplacer la méthode searchTNF par updateView\n    updateView() {\n      if (this.searchStartDate && this.searchEndDate) {\n        const startDate = new Date(this.searchStartDate);\n        this.currentYear = startDate.getFullYear();\n        this.currentMonth = startDate.getMonth();\n      }\n    },\n    clearDateFilters() {\n      this.searchStartDate = \"\";\n      this.searchEndDate = \"\";\n      this.updateView();\n    },\n    getTNFDaysInPeriod(resource, startDate, endDate) {\n      const tnfDays = [];\n      const resourceEvents = this.events.filter(event => event.resource === resource.name);\n      for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {\n        // Ignorer les week-ends et les jours fériés\n        if (this.isWeekend(d.getDate(), d.getMonth()).isWeekend || this.isJourFerie(d.getDate(), d.getMonth())) {\n          continue;\n        }\n        const eventsOnDay = resourceEvents.filter(event => this.isEventOnDay(event, d));\n        if (eventsOnDay.length === 0) {\n          tnfDays.push(new Date(d.getFullYear(), d.getMonth(), d.getDate()));\n        }\n      }\n      return tnfDays;\n    },\n    isHighlightedTNF(resourceName, day, monthIndex) {\n      if (!this.searchStartDate || !this.searchEndDate) return false;\n      const resource = this.resources.find(r => r.name === resourceName);\n      if (!resource) return false;\n      const date = new Date(this.currentYear, monthIndex !== undefined ? monthIndex : this.currentMonth, day);\n      const startDate = new Date(this.searchStartDate);\n      const endDate = new Date(this.searchEndDate);\n\n      // Exclure le jour s'il est en dehors de la plage ou s'il est un jour férié\n      if (date < startDate || date > endDate || this.isJourFerie(day, monthIndex)) return false;\n      const tnfDays = this.getTNFDaysInPeriod(resource, startDate, endDate);\n      return tnfDays.some(tnfDay => tnfDay.getDate() === date.getDate() && tnfDay.getMonth() === date.getMonth() && tnfDay.getFullYear() === date.getFullYear());\n    },\n    async fetchJoursFeries() {\n      try {\n        const response = await axios.get(`${API_URL}/jours-feries`, {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n          }\n        });\n        this.joursFeries = response.data.filter(jour => this.selectedPays === \"\" || jour.agence && jour.agence.pays === this.selectedPays);\n      } catch (error) {\n        console.error(\"Erreur lors de la récupération des jours fériés:\", error);\n      }\n    },\n    async fetchClients() {\n      try {\n        const response = await axios.get(`${API_URL}/clients`, {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n          }\n        });\n        this.clients = response.data;\n      } catch (error) {\n        console.error(\"Erreur lors de la récupération des clients:\", error);\n      }\n    },\n    updateSelectedClient() {\n      const selectedClient = this.clients.find(client => client.id === this.selectedClientId);\n      if (selectedClient) {\n        this.selectedClientColor = selectedClient.color;\n      }\n    },\n    async saveEvent() {\n      try {\n        await axios.post(`${API_URL}/interventions`, {\n          user_id: this.user_id,\n          client_id: this.selectedClientId,\n          // Assurez-vous d'utiliser l'ID du client ici\n          commentaire: this.comment,\n          date_debut: this.startDate,\n          date_fin: this.endDate,\n          color: this.selectedClientColor\n        }, {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n          }\n        });\n        await this.fetchResourcesAndEvents();\n        this.closeEventModal();\n      } catch (error) {\n        console.error(\"Erreur lors de la sauvegarde de l'événement:\", error);\n        if (error.response) {\n          console.error(\"Détails de l'erreur:\", error.response.data);\n          // Affichez un message d'erreur utilisateur ici si nécessaire\n        }\n      }\n    },\n    async updateEvent() {\n      try {\n        await axios.post(\n        // Utilisez PUT pour les mises à jour\n        `${API_URL}/interventions/${this.selectedEvent.id}`, {\n          user_id: this.user_id,\n          client_id: this.selectedClientId,\n          // Assurez-vous d'utiliser l'ID du client ici\n          commentaire: this.comment,\n          date_debut: this.startDate,\n          date_fin: this.endDate,\n          color: this.selectedClientColor\n        }, {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n          }\n        });\n        await this.fetchResourcesAndEvents();\n        this.closeEventModal();\n      } catch (error) {\n        console.error(\"Erreur lors de la mise à jour de l'événement:\", error);\n        if (error.response) {\n          console.error(\"Détails de l'erreur:\", error.response.data);\n          // Affichez un message d'erreur utilisateur ici si nécessaire\n        }\n      }\n    },\n    selectClient(clientId) {\n      const client = this.clients.find(c => c.id === clientId);\n      if (client) {\n        this.selectedClient = client.nom;\n        this.selectedClientId = client.id;\n        this.selectedClientColor = client.color; // Assurez-vous que cette ligne est présente\n      } else {\n        this.selectedClient = null;\n        this.selectedClientId = null;\n        this.selectedClientColor = \"\";\n      }\n    },\n    openEventModal(day, resourceName, monthIndex = null) {\n      let selectedDate;\n      if (monthIndex !== null) {\n        selectedDate = new Date(this.currentYear, monthIndex, day);\n      } else {\n        selectedDate = new Date(this.currentYear, this.currentMonth, day);\n      }\n      if (!isNaN(selectedDate.getTime())) {\n        const headerDate = format(selectedDate, \"yyyy-MM-dd\");\n        this.startDate = headerDate;\n        const resource = this.resources.find(r => r.name === resourceName);\n        if (resource) {\n          this.selectedEvent = {\n            resourceName,\n            resourceId: resource.id,\n            day: this.startDate\n          };\n          this.user_id = resource.id;\n          const events = monthIndex !== null ? this.getEventsForMonth(resourceName, monthIndex, day) : this.filteredEventsByDay[resourceName][day];\n          const event = events && events[0];\n          if (event) {\n            const intervention = resource.interventions.find(i => i.id === event.id);\n            if (intervention) {\n              this.selectedClientId = intervention.client_id; // L'ID du client\n              this.selectedClient = intervention.client_name; // Le nom du client\n              this.comment = intervention.commentaire;\n              this.startDate = format(new Date(intervention.date_debut), \"yyyy-MM-dd\");\n              this.endDate = format(new Date(intervention.date_fin), \"yyyy-MM-dd\");\n              this.selectedClientColor = intervention.client_color, this.selectedEvent.id = intervention.id; // Marquer comme événement existant\n            }\n          } else {\n            // Réinitialiser pour un nouvel événement\n            this.selectedClient = null;\n            this.selectedClientId = null;\n            this.comment = \"\";\n            this.startDate = headerDate;\n            this.endDate = \"\";\n            this.selectedClientColor = \"\"; // Valeur par défaut\n            this.selectedEvent.id = null; // Marquer comme nouvel événement\n          }\n          this.isEventModalOpen = true; // Ouvrir le modal\n        }\n      }\n    },\n    async deleteEvent() {\n      try {\n        await axios.delete(`${API_URL}/interventions/${this.selectedEvent.id}`, {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n          }\n        });\n        await this.fetchResourcesAndEvents();\n        this.closeEventModal();\n      } catch (error) {\n        console.error(\"Erreur lors de la suppression de l'événement:\", error);\n        if (error.response) {\n          console.error(\"Détails de l'erreur:\", error.response.data);\n        }\n      }\n    },\n    closeEventModal() {\n      this.isEventModalOpen = false;\n      this.selectedEvent = {};\n      this.selectedClient = null;\n      this.comment = \"\";\n      this.startDate = \"\";\n      this.endDate = \"\";\n      this.selectedClientColor = \"\";\n    },\n    resetToToday() {\n      const today = new Date();\n      this.currentYear = today.getFullYear();\n      this.currentMonth = today.getMonth();\n      this.currentDay = today.getDate();\n    },\n    prevPeriod() {\n      if (this.viewMode === \"month\") {\n        this.currentMonth--;\n        if (this.currentMonth < 0) {\n          this.currentMonth = 11;\n          this.currentYear--;\n        }\n      } else {\n        this.currentYear--;\n      }\n      this.fetchJoursFeries(); // Ajoutez cette ligne\n    },\n    nextPeriod() {\n      if (this.viewMode === \"month\") {\n        this.currentMonth++;\n        if (this.currentMonth > 11) {\n          this.currentMonth = 0;\n          this.currentYear++;\n        }\n      } else {\n        this.currentYear++;\n      }\n      this.fetchJoursFeries(); // Ajoutez cette ligne\n    },\n    getDayLabel(index, day) {\n      const dayDate = new Date(this.currentYear, this.currentMonth, day);\n      return format(dayDate, \"EEE dd\");\n    },\n    getDaysInMonth(monthIndex = null) {\n      const month = monthIndex !== null ? monthIndex : this.currentMonth;\n      const daysInMonth = new Date(this.currentYear, month + 1, 0).getDate();\n      return Array.from({\n        length: daysInMonth\n      }, (_, i) => i + 1);\n    },\n    getDaysInYear() {\n      const months = [];\n      for (let month = 0; month < 12; month++) {\n        const daysInMonth = new Date(this.currentYear, month + 1, 0).getDate();\n        const days = Array.from({\n          length: daysInMonth\n        }, (_, i) => i + 1);\n        months.push({\n          month: format(new Date(this.currentYear, month), \"MMMM\"),\n          days\n        });\n      }\n      return months;\n    },\n    isWeekend(day, month = this.currentMonth) {\n      const date = new Date(this.currentYear, month, day);\n      const dayOfWeek = date.getDay();\n      return {\n        isWeekend: dayOfWeek === 0 || dayOfWeek === 6,\n        dayOfWeek\n      };\n    },\n    isEventOnDay(event, day) {\n      const eventStart = new Date(event.startDate);\n      const eventEnd = new Date(event.endDate);\n      const dayOfWeek = day.getDay();\n      const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;\n      const dayDate = new Date(day.getFullYear(), day.getMonth(), day.getDate());\n      const eventStartDate = new Date(eventStart.getFullYear(), eventStart.getMonth(), eventStart.getDate());\n      const eventEndDate = new Date(eventEnd.getFullYear(), eventEnd.getMonth(), eventEnd.getDate());\n      if (isWeekend) {\n        // Pour les week-ends, afficher uniquement les événements qui commencent un week-end\n        return (eventStart.getDay() === 0 || eventStart.getDay() === 6) && dayDate >= eventStartDate && dayDate <= eventEndDate;\n      } else {\n        // Pour les jours de semaine, afficher uniquement les événements qui commencent un jour de semaine\n        return eventStart.getDay() !== 0 && eventStart.getDay() !== 6 && dayDate >= eventStartDate && dayDate <= eventEndDate;\n      }\n    },\n    getEventsForMonth(resourceName, monthIndex, day) {\n      const date = new Date(this.currentYear, monthIndex, day);\n      return this.events.filter(event => event.resource === resourceName && this.isEventOnDay(event, date));\n    },\n    async fetchResourcesAndEvents() {\n      try {\n        const response = await axios.get(`${API_URL}/interventions`, {\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n          }\n        });\n        const data = response.data;\n        this.resources = data.map(user => ({\n          id: user.id,\n          name: user.name,\n          agence: user.agence,\n          interventions: user.interventions\n        }));\n        this.events = data.flatMap(user => user.interventions.map(intervention => ({\n          id: intervention.id,\n          name: intervention.commentaire,\n          startDate: intervention.date_debut,\n          endDate: intervention.date_fin,\n          resource: user.name,\n          color: intervention.client_color,\n          resourceId: user.id,\n          clientAbbreviation: intervention.client_abbreviation,\n          clientName: intervention.client_name\n        })));\n\n        // Filtrer les utilisateurs et les jours fériés en fonction de l'agence sélectionnée\n        if (this.selectedPays) {\n          this.resources = this.resources.filter(resource => resource.agence && resource.agence.pays === this.selectedPays);\n          this.joursFeries = this.joursFeries.filter(jour => jour.agence && jour.agence.pays === this.selectedPays);\n        }\n      } catch (error) {\n        console.error(\"Erreur lors de la récupération des données:\", error);\n      }\n    },\n    calculateStatisticsByColor() {\n      const statistics = {};\n      let startDate, endDate;\n      if (this.viewMode === 'month') {\n        startDate = new Date(this.currentYear, this.currentMonth, 1);\n        endDate = new Date(this.currentYear, this.currentMonth + 1, 0);\n      } else if (this.viewMode === 'year') {\n        startDate = new Date(this.currentYear, 0, 1);\n        endDate = new Date(this.currentYear, 11, 31);\n      }\n      this.events.forEach(event => {\n        const eventStartDate = new Date(event.startDate);\n        const eventEndDate = new Date(event.endDate);\n        if (eventStartDate >= startDate && eventEndDate <= endDate) {\n          const clientColor = this.getClientColor(event.color);\n          const clientName = this.getColorName(clientColor);\n          if (!statistics[clientColor]) {\n            statistics[clientColor] = {\n              name: clientName,\n              count: 0\n            };\n          }\n          statistics[clientColor].count++;\n        }\n      });\n      return statistics;\n    },\n    getClientColor(color) {\n      if (!color || typeof color !== \"number\") {\n        return this.colorMapping.default.class; // Couleur par défaut si la couleur n'est pas définie ou invalide\n      }\n      return this.colorMapping[color] ? this.colorMapping[color].class : this.colorMapping.default.class;\n    },\n    getColorName(color) {\n      if (!color || typeof color !== \"number\") {\n        return this.colorMapping.default.name; // Nom par défaut si la couleur n'est pas définie ou invalide\n      }\n      return this.colorMapping[color] ? this.colorMapping[color].name : this.colorMapping.default.name;\n    }\n  }\n};","map":{"version":3,"names":["format","axios","jsPDF","ExcelJS","API_URL","data","colorMapping","name","class","default","isExportModalOpen","currentYear","Date","getFullYear","currentMonth","getMonth","monthsOfYear","currentDay","getDate","viewMode","resources","events","selectedClientId","clientSearch","clients","joursFeries","agences","bangeResults","isBANGEModalOpen","bangeStartDate","bangeEndDate","searchStartDate","searchEndDate","tnfSearchResults","isEventModalOpen","selectedEvent","hoveredEvent","hoveredDay","selectedClientColor","comment","startDate","endDate","user_id","selectedPays","computed","filteredClients","filter","client","nom","toLowerCase","includes","displayPeriod","firstDayOfMonth","firstDayOfYear","formattedJoursFeries","map","jourFerie","date","date_ferie","nom_ferie","periodDays","getDaysInMonth","getDaysInYear","filteredResources","filtered","matchingResourceIds","Set","event","clientName","resourceId","resource","has","id","tnfDays","getTNFDaysInPeriod","length","agence","pays","filteredEventsByDay","filteredEvents","forEach","days","flatMap","month","day","dayDate","isEventOnDay","statisticsByColor","calculateStatisticsByColor","watch","updateView","fetchJoursFeries","fetchResourcesAndEvents","mounted","fetchClients","fetchAgences","methods","openExportModal","closeExportModal","exportToXLSX","workbook","Workbook","worksheet","addWorksheet","columns","header","key","width","eventStartDate","eventEndDate","start","end","index","addRow","Numero","Ressource","Date_de_debut","Date_de_fin","Client","Commentaire","Abbreviation","clientAbbreviation","headerRow","getRow","eachCell","cell","fill","type","gradient","degree","stops","position","color","argb","font","bold","alignment","horizontal","vertical","currentDate","toLocaleDateString","replace","xlsx","writeBuffer","then","blob","Blob","link","document","createElement","href","URL","createObjectURL","download","click","revokeObjectURL","exportToPDF","doc","orientation","unit","dataKey","autoTable","head","col","body","row","startY","styles","fillColor","textColor","fontStyle","halign","valign","cellPadding","headStyles","save","response","get","headers","Authorization","localStorage","getItem","error","console","filterInterventionsByClientName","lowerCaseClientName","calculateBANGE","totalBANGE","currentWeekStart","weekEnd","setDate","totalTNF","workingDays","d","isWeekend","isHoliday","isJourFerie","log","getEventsForMonth","etp","Math","min","weeklyBANGE","toFixed","parseFloat","calculateAndDisplayBANGE","bangeResult","push","bange","alert","closeBANGEModal","getDayAbbreviation","getDay","isWednesday","monthIndex","getWeeklyBANGE","initialDate","weekStart","dayOfWeek","offsetToMonday","getMonthlyBANGE","getJourFerieName","formattedDate","find","jour","some","calculateBusinessDays","count","showComment","hideComment","clearDateFilters","resourceEvents","eventsOnDay","isHighlightedTNF","resourceName","r","undefined","tnfDay","updateSelectedClient","selectedClient","saveEvent","post","client_id","commentaire","date_debut","date_fin","closeEventModal","updateEvent","selectClient","clientId","c","openEventModal","selectedDate","isNaN","getTime","headerDate","intervention","interventions","i","client_name","client_color","deleteEvent","delete","resetToToday","today","prevPeriod","nextPeriod","getDayLabel","daysInMonth","Array","from","_","months","eventStart","eventEnd","user","client_abbreviation","statistics","clientColor","getClientColor","getColorName"],"sources":["C:\\Users\\gongue\\Desktop\\frontsbs\\src\\views\\StaffingView.vue"],"sourcesContent":["<template>\r\n  <div class=\"container p-4 mx-auto\">\r\n    <!-- Conteneur principal pour le calcul du bench et la recherche -->\r\n    <div class=\"flex items-center justify-between mb-2 \">\r\n      <!-- Formulaire pour le calcul du BANGE -->\r\n      <div class=\"mb-4\">\r\n        <h3 class=\"mb-0 text-lg font-semibold text-gray-800 text-[10px]\">\r\n          Calcul du Bench\r\n        </h3>\r\n        <div class=\"flex items-center p-4 space-x-6 rounded-lg shadow-md bg-gray-50\">\r\n          <div class=\"flex items-center space-x-2\">\r\n            <label\r\n              for=\"bange-start-date\"\r\n              class=\"text-sm font-medium text-gray-700 text-[10px]\"\r\n              >Date de début:</label\r\n            >\r\n            <input\r\n              id=\"bange-start-date\"\r\n              v-model=\"bangeStartDate\"\r\n              type=\"date\"\r\n              class=\"p-2 border border-gray-300 rounded-md focus:ring focus:ring-blue-300 text-[10px]\"\r\n            />\r\n          </div>\r\n          <div class=\"flex items-center space-x-2\">\r\n            <label\r\n              for=\"bange-end-date\"\r\n              class=\"text-sm font-medium text-gray-700 text-[10px]\"\r\n              >Date de fin:</label\r\n            >\r\n            <input\r\n              id=\"bange-end-date\"\r\n              v-model=\"bangeEndDate\"\r\n              type=\"date\"\r\n              class=\"p-2 border border-gray-300 rounded-md focus:ring focus:ring-blue-300 text-[10px]\"\r\n            />\r\n          </div>\r\n          <button\r\n            @click=\"calculateAndDisplayBANGE\"\r\n            class=\"px-4 py-2 text-[10px] text-white bg-blue-500 rounded shadow-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50\"\r\n          >\r\n            Calculer le Bench\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Modal pour afficher les résultats du BANGE -->\r\n      <div\r\n        v-if=\"isBANGEModalOpen\"\r\n        class=\"fixed inset-0 z-[70] flex items-center justify-center bg-black bg-opacity-50\"\r\n      >\r\n        <div class=\"w-full max-w-md p-6 bg-white rounded-lg\">\r\n          <h2 class=\"mb-4 text-xl font-bold\">Résultats du Bench</h2>\r\n          <div class=\"overflow-y-auto max-h-60\">\r\n            <table class=\"w-full\">\r\n              <thead>\r\n                <tr>\r\n                  <th class=\"px-4 py-2 font-semibold text-left bg-gray-100\">Periode</th>\r\n                  <th class=\"px-4 py-2 font-semibold text-right bg-gray-100\">Etp</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                <tr v-for=\"result in bangeResults\" :key=\"result.date\" class=\"border-b\">\r\n                  <td class=\"px-4 py-2\">{{ result.date }}</td>\r\n                  <td class=\"px-4 py-2 text-right\">{{ result.bange }}</td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <button\r\n            @click=\"closeBANGEModal\"\r\n            class=\"px-4 py-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50\"\r\n          >\r\n            Fermer\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Formulaire de recherche -->\r\n      <div class=\"mb-4\">\r\n        <h3 class=\"mb-0 text-lg font-semibold text-gray-800 text-[10px]\">Recherche TNF</h3>\r\n        <div class=\"flex items-center p-4 space-x-6 rounded-lg shadow-md bg-gray-50\">\r\n          <div class=\"flex items-center space-x-2\">\r\n            <label for=\"start-search\" class=\"text-sm font-medium text-gray-700 text-[10px]\"\r\n              >Date de début:</label\r\n            >\r\n            <input\r\n              id=\"start-search\"\r\n              v-model=\"searchStartDate\"\r\n              type=\"date\"\r\n              class=\"p-2 border border-gray-300 rounded-md focus:ring focus:ring-blue-300 text-[10px]\"\r\n            />\r\n          </div>\r\n          <div class=\"flex items-center space-x-2\">\r\n            <label for=\"end-search\" class=\"text-sm font-medium text-gray-700 text-[10px]\"\r\n              >Date de fin:</label\r\n            >\r\n            <input\r\n              id=\"end-search\"\r\n              v-model=\"searchEndDate\"\r\n              type=\"date\"\r\n              class=\"p-2 border border-gray-300 rounded-md focus:ring focus:ring-blue-300 text-[10px]\"\r\n            />\r\n          </div>\r\n          <button\r\n            @click=\"clearDateFilters\"\r\n            class=\"px-4 py-2 text-[10px] text-white bg-red-500 rounded shadow-lg hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50\"\r\n          >\r\n            Effacer les filtres\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"flex justify-center p-2 space-x-4 \">\r\n     \r\n<!-- Modal pour sélectionner la période et le format d'exportation -->\r\n    <div v-if=\"isExportModalOpen\" class=\"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-[70]\">\r\n      <div class=\"w-full max-w-md p-6 bg-white rounded-lg shadow-lg\">\r\n        <h2 class=\"mb-4 text-xl font-bold\">Exporter les données</h2>\r\n        <div class=\"mb-4\">\r\n          <label for=\"start-date\" class=\"block text-sm font-medium text-gray-700\">Date de début :</label>\r\n          <input type=\"date\" v-model=\"startDate\" id=\"start-date\" class=\"p-2 mt-1 border border-gray-300 rounded-md focus:ring focus:ring-blue-300\" />\r\n        </div>\r\n        <div class=\"mb-4\">\r\n          <label for=\"end-date\" class=\"block text-sm font-medium text-gray-700\">Date de fin :</label>\r\n          <input type=\"date\" v-model=\"endDate\" id=\"end-date\" class=\"p-2 mt-1 border border-gray-300 rounded-md focus:ring focus:ring-blue-300\" />\r\n        </div>\r\n        <div class=\"flex justify-between gap-2\">\r\n          <button @click=\"exportToXLSX\" class=\"px-4 py-2 text-xs text-white bg-green-500 rounded\">Exporter en XLSX</button>\r\n          <button @click=\"exportToPDF\" class=\"px-4 py-2 text-xs text-white bg-blue-500 rounded\">Exporter en PDF</button>\r\n          <button @click=\"closeExportModal\" class=\"px-4 py-2 text-xs text-white bg-red-500 rounded\">Fermer</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n<!-- Legend Container -->\r\n <div class=\"pt-2\">\r\n    <h4 class=\"mb-2 font-bold\">Statistiques par Couleur</h4>\r\n    <div class=\"flex flex-wrap gap-2\">\r\n      <div v-for=\"(stat, color) in statisticsByColor\" :key=\"color\" class=\"flex items-center p-2 space-x-2 bg-white rounded shadow-md\">\r\n        <div class=\"flex items-center justify-center h-4 p-1\" :class=\"carac(color)\">\r\n          <small class=\"text-[8px] text-white\">{{ stat.count }}</small>\r\n        </div>\r\n        <span class=\"text-[8px]\">{{ stat.name }}</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n    </div>\r\n    <div class=\"flex justify-between p-3 mt-1 bg-blue-500 rounded-t-md\">\r\n      <div class=\"flex items-center justify-\">\r\n        <div>\r\n          <button\r\n            @click=\"prevPeriod\"\r\n            class=\"px-4 py-2 text-white bg-blue-500 rounded shadow-lg text-[10px]\"\r\n          >\r\n            Précédent\r\n          </button>\r\n          <button\r\n            @click=\"resetToToday\"\r\n            class=\"px-4 py-2 ml-4 text-white bg-green-500 rounded shadow-lg text-[10px]\"\r\n          >\r\n            Mois en cours\r\n          </button>\r\n          <button\r\n            @click=\"nextPeriod\"\r\n            class=\"px-4 py-2 ml-4 text-white bg-blue-500 rounded shadow-lg text-[10px]\"\r\n          >\r\n            Suivant\r\n          </button>\r\n          <input\r\n            id=\"client-search\"\r\n            v-model=\"clientSearch\"\r\n            type=\"text\"\r\n            class=\"px-4 py-2 ml-4 border border-gray-300 rounded-md focus:ring focus:ring-blue-300 text-[10px]\"\r\n            placeholder=\"Search with client name's\"\r\n          />\r\n        </div>\r\n      </div>\r\n      <div>\r\n        <h2 class=\"text-2xl font-bold text-white\">{{ displayPeriod }}</h2>\r\n      </div>\r\n      <div class=\"flex\">\r\n        <button\r\n          @click=\"viewMode = 'month'\"\r\n          :class=\"{ 'bg-white text-black': viewMode === 'month' }\"\r\n          class=\"px-4 py-2 transition-colors duration-200 rounded shadow-lg text-[10px]\"\r\n        >\r\n          Mois\r\n        </button>\r\n        <button\r\n          @click=\"viewMode = 'year'\"\r\n          :class=\"{ 'bg-white text-black': viewMode === 'year' }\"\r\n          class=\"px-4 py-2 ml-2 transition-colors duration-200 rounded shadow-lg text-[10px]\"\r\n        >\r\n          Année\r\n        </button>\r\n        \r\n        <select\r\n          v-model=\"selectedPays\"\r\n          class=\"px-4 py-2 ml-2 transition-colors duration-200 rounded shadow-lg text-[10px]\"\r\n        >\r\n          <option value=\"\">Tous les pays</option>\r\n          <option v-for=\"agence in agences\" :key=\"agence.id\" :value=\"agence.pays\">\r\n            {{ agence.pays }}\r\n          </option>\r\n        </select>\r\n         <button @click=\"openExportModal\" class=\"px-4 py-2 ml-2 text-xs text-black rounded bg-gray-50\">Exporter</button>\r\n      </div>\r\n    </div>\r\n    <!-- Vue Mensuelle -->\r\n    <div v-if=\"viewMode === 'month'\" class=\"overflow-x-auto overflow-y-scroll md:h-[400px]\">\r\n      <table class=\"min-w-full border border-gray-300 table-auto\">\r\n        <thead class=\"sticky z-50 text-white bg-blue-500\">\r\n          <tr class=\"sticky z-50 bg-blue-500\">\r\n            <th class=\"sticky left-0 w-1/4 p-2 text-[9px] z-[70] bg-blue-500 rounded-l-lg\">\r\n              Ressources\r\n            </th>\r\n            <th\r\n              v-for=\"(day, index) in periodDays\"\r\n              :key=\"index\"\r\n              class=\"sticky top-0 p-2 border-b bg-blue-500 z-50 border-gray-300 w-[50px] text-[9px]\"\r\n            >\r\n              {{ getDayLabel(index, day) }}\r\n            </th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <!-- Resource rows -->\r\n          <tr v-for=\"resource in filteredResources\" :key=\"resource.name\">\r\n            <td class=\"sticky left-0 p-1 bg-white text-[10px] z-50\">\r\n              {{ resource.name }}\r\n            </td>\r\n            <td\r\n              v-for=\"(day, index) in periodDays\"\r\n              :key=\"index\"\r\n              class=\"p-1 border-b border-gray-300 w-[50px] text-[9px]\"\r\n              :class=\"{\r\n                'bg-red-400': isJourFerie(day),\r\n                'bg-gray-300': isWeekend(day).isWeekend,\r\n              }\"\r\n              @click=\"openEventModal(day, resource.name)\"\r\n            >\r\n              <!-- Holiday Display -->\r\n              <div v-if=\"isJourFerie(day)\" class=\"text-xs font-bold text-white\">\r\n                <div class=\"w-[50px] h-6 p-1 text-[6px] text-white bg-red-400 rounded\">\r\n                  {{ getJourFerieName(day, monthIndex) }}\r\n                </div>\r\n              </div>\r\n\r\n              <!-- Weekend Display -->\r\n              <div\r\n                v-else-if=\"isWeekend(day).isWeekend\"\r\n                class=\"w-full h-full p-1 text-[9px] text-black bg-gray-300 rounded\"\r\n              >\r\n                <template v-if=\"filteredEventsByDay[resource.name][day].length\">\r\n                  <div\r\n                    v-for=\"event in filteredEventsByDay[resource.name][day]\"\r\n                    :key=\"event.id\"\r\n                    class=\"relative w-[50px] h-6 p-1 text-[9px] text-center rounded cursor-pointer\"\r\n                    :class=\"getClientColor(event.color)\"\r\n                    @mouseover=\"showComment(event, day)\"\r\n                    @mouseleave=\"hideComment\"\r\n                  >\r\n                    {{ event.clientAbbreviation }}\r\n                  </div>\r\n                </template>\r\n                <template v-else><p class=\"text-[9px]\">weekend</p></template>\r\n              </div>\r\n\r\n              <!-- Normal Day Display (not holiday, not weekend) -->\r\n              <div v-else>\r\n                <template v-if=\"filteredEventsByDay[resource.name][day].length\">\r\n                  <div\r\n                    v-for=\"event in filteredEventsByDay[resource.name][day]\"\r\n                    :key=\"event.id\"\r\n                    class=\"relative w-[50px] h-6 p-1 text-[9px] text-center rounded cursor-pointer\"\r\n                    :class=\"getClientColor(event.color)\"\r\n                    @mouseover=\"showComment(event, day)\"\r\n                    @mouseleave=\"hideComment\"\r\n                  >\r\n                    {{ event.clientAbbreviation }}\r\n                    <div\r\n                      v-if=\"hoveredEvent === event && hoveredDay === day\"\r\n                      class=\"absolute z-10 p-2 text-sm text-white whitespace-normal bg-gray-800 rounded shadow-lg\"\r\n                      style=\"\r\n                        width: 200px;\r\n                        bottom: 100%;\r\n                        left: 50%;\r\n                        transform: translateX(-50%);\r\n                      \"\r\n                    >\r\n                      {{ event.name }}\r\n                    </div>\r\n                  </div>\r\n                </template>\r\n                <!-- TNF for normal days without events -->\r\n                <template v-else>\r\n                  <div\r\n                    v-if=\"!isJourFerie(day)\"\r\n                    class=\"h-6 p-1 text-[9px] text-white bg-green-400 rounded cursor-pointer hover:bg-green-600\"\r\n                    :class=\"{\r\n                      'border-2 border-blue-600': isHighlightedTNF(resource.name, day),\r\n                    }\"\r\n                  >\r\n                    TNF\r\n                  </div>\r\n                </template>\r\n              </div>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n\r\n    <!-- Vue Annuelle -->\r\n<div v-else-if=\"viewMode === 'year'\" class=\"overflow-x-auto overflow-y-scroll md:h-[400px]\">\r\n  <div class=\"relative overflow-x-auto\">\r\n    <table class=\"min-w-full border border-gray-900 table-auto\">\r\n      <thead class=\"sticky top-0 z-10 text-white bg-blue-500\">\r\n        <tr>\r\n          <th class=\"sticky left-0 z-50 w-1/4 p-1 bg-blue-500 rounded-l-lg\">Ressources</th>\r\n          <th\r\n            v-for=\"month in monthsOfYear\"\r\n            :key=\"month\"\r\n            class=\"p-1 border border-gray-300\"\r\n          >\r\n            <div>{{ month }}</div>\r\n            <div class=\"flex row-auto gap-1\">\r\n              <div\r\n                v-for=\"day in getDaysInMonth(monthsOfYear.indexOf(month))\"\r\n                :key=\"`${month}-${day}`\"\r\n                class=\"text-[9px] p-1 w-[50px] mr-[8px]\"\r\n              >\r\n                {{\r\n                  getDayAbbreviation(\r\n                    new Date(currentYear, monthsOfYear.indexOf(month), day)\r\n                  )\r\n                }}\r\n                {{ String(day).padStart(2, \"0\") }}\r\n              </div>\r\n            </div>\r\n          </th>\r\n        </tr>\r\n      </thead>\r\n      <tbody class=\"overflow-x-auto\">\r\n        <!-- Bench Row pour la vue annuelle -->\r\n        <tr class=\"\">\r\n          <td class=\"sticky left-0 p-2 bg-white text-[9px] font-bold gap-2 \">Bench</td>\r\n          <td\r\n            v-for=\"(month, monthIndex) in getDaysInYear()\"\r\n            :key=\"monthIndex\"\r\n            class=\"p-1 border border-gray-300 text-[9px]\"\r\n          >\r\n            <div class=\"flex gap-[2px]\">\r\n              <div\r\n                v-for=\"day in month.days\"\r\n                :key=\"day\"\r\n                class=\"mx-[5px] text-[9px] text-center bg-transparent w-[50px] h-6 gap-3 rounded-sm\"\r\n              >\r\n                <!-- Ajout de la condition pour les jours fériés -->\r\n                <div v-if=\"isJourFerie(day, monthIndex)\">\r\n                  <div\r\n                    class=\"w-[50px] h-6 p-1 text-[1px] text-white bg-transparent rounded\"\r\n                  >\r\n                    {{ getJourFerieName(day, monthIndex) }}\r\n                  </div>\r\n                </div>\r\n                <div v-else-if=\"isWeekend(day, monthIndex).isWeekend\">\r\n                  <div\r\n                    class=\"w-[50px] h-6 p-1 text-[1px] text-center text-white bg-transparent rounded\"\r\n                  >\r\n                    weekend\r\n                  </div>\r\n                </div>\r\n                <div v-else>\r\n                  <!-- Afficher le BANGE pour chaque mercredi en vérifiant directement le jour -->\r\n                  <div\r\n                    v-if=\"new Date(currentYear, monthIndex, day).getDay() === 3\"\r\n                    class=\"w-[50px] h-6 p-1 text-[9px] text-white bg-cyan-400 rounded cursor-pointer hover:bg-green-600\"\r\n                  >\r\n                    {{ getWeeklyBANGE(day, monthIndex).bange }}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </td>\r\n        </tr>\r\n        <tr v-for=\"resource in filteredResources\" :key=\"resource.name\">\r\n          <td class=\"sticky left-0  p-1 bg-white border text-[9px]\">\r\n            {{ resource.name }}\r\n          </td>\r\n          <td\r\n            v-for=\"(month, monthIndex) in getDaysInYear()\"\r\n            :key=\"monthIndex\"\r\n            class=\"p-1 border border-gray-300 text-[9px]\"\r\n          >\r\n            <div class=\"flex gap-1\">\r\n              <div\r\n                v-for=\"day in month.days\"\r\n                :key=\"day\"\r\n                class=\"p-1 text-[9px] text-center rounded-lg\"\r\n                @click=\"openEventModal(day, resource.name, monthIndex)\"\r\n              >\r\n                <!-- Ajout de la condition pour les jours fériés -->\r\n                <div v-if=\"isJourFerie(day, monthIndex)\">\r\n                  <div class=\"w-[50px] h-6 p-1 text-[6px] text-white bg-red-400 rounded\">\r\n                    {{ getJourFerieName(day, monthIndex) }}\r\n                  </div>\r\n                </div>\r\n                <div v-else-if=\"isWeekend(day, monthIndex).isWeekend\">\r\n                  <div\r\n                    class=\"w-[50px] h-6 p-1 text-[9px] text-center bg-gray-300 rounded\"\r\n                  >\r\n                    <template\r\n                      v-if=\"getEventsForMonth(resource.name, monthIndex, day).length\"\r\n                    >\r\n                      <div\r\n                        v-for=\"event in getEventsForMonth(resource.name, monthIndex, day)\"\r\n                        :key=\"event.id\"\r\n                        class=\"relative text-center rounded cursor-pointer w-[50px] h-6 p-1 text-[9px]\"\r\n                        :class=\"getClientColor(event.color)\"\r\n                        @mouseover=\"showComment(event, day)\"\r\n                        @mouseleave=\"hideComment\"\r\n                      >\r\n                        {{ event.clientAbbreviation }}\r\n                        <div\r\n                          v-if=\"hoveredEvent === event && hoveredDay === day\"\r\n                          class=\"absolute z-10 p-1 text-[9px] text-white whitespace-normal bg-gray-800 rounded shadow-lg\"\r\n                          style=\"\r\n                            width: 200px;\r\n                            bottom: 100%;\r\n                            left: 50%;\r\n                            transform: translateX(-50%);\r\n                          \"\r\n                        >\r\n                          {{ event.name }}\r\n                        </div>\r\n                      </div>\r\n                    </template>\r\n                    <template v-else>weekend</template>\r\n                  </div>\r\n                </div>\r\n                <div v-else>\r\n                  <template\r\n                    v-if=\"getEventsForMonth(resource.name, monthIndex, day).length\"\r\n                  >\r\n                    <div\r\n                      v-for=\"event in getEventsForMonth(resource.name, monthIndex, day)\"\r\n                      :key=\"event.id\"\r\n                      class=\"relative w-[50px] h-6 p-1 text-[9px] text-center rounded cursor-pointer\"\r\n                      :class=\"getClientColor(event.color)\"\r\n                      @mouseover=\"showComment(event, day)\"\r\n                      @mouseleave=\"hideComment\"\r\n                    >\r\n                      {{ event.clientAbbreviation }}\r\n                      <div\r\n                        v-if=\"hoveredEvent === event && hoveredDay === day\"\r\n                        class=\"absolute z-10 w-[50px] h-6 p-1 text-[9px] text-white whitespace-normal bg-gray-800 rounded shadow-lg\"\r\n                        style=\"\r\n                          width: 200px;\r\n                          bottom: 100%;\r\n                          left: 50%;\r\n                          transform: translateX(-50%);\r\n                        \"\r\n                      >\r\n                        {{ event.name }}\r\n                      </div>\r\n                    </div>\r\n                  </template>\r\n                  <template v-else>\r\n                    <div\r\n                      v-if=\"!isJourFerie(day, monthIndex)\"\r\n                      class=\"w-[50px] h-6 p-1 text-[9px] text-white bg-green-400 rounded cursor-pointer hover:bg-green-600\"\r\n                      :class=\"{\r\n                        'border-2 border-blue-600': isHighlightedTNF(\r\n                          resource.name,\r\n                          day,\r\n                          monthIndex\r\n                        ),\r\n                      }\"\r\n                    >\r\n                      TNF\r\n                    </div>\r\n                  </template>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>\r\n\r\n\r\n    <!-- Modal pour ajouter/modifier un événement -->\r\n    <div\r\n      v-if=\"isEventModalOpen\"\r\n      class=\"fixed inset-0 z-50 flex items-center justify-center p-6 bg-black bg-opacity-50 backdrop-blur-sm\"\r\n      @click.self=\"closeEventModal\"\r\n    >\r\n      <div\r\n        class=\"w-full max-w-2xl p-6 transition-transform duration-300 ease-in-out transform scale-75 bg-white rounded-lg shadow-lg\"\r\n      >\r\n        <h3 class=\"mb-4 text-lg font-semibold text-gray-800\">\r\n          Ressource : {{ selectedEvent.resourceName }}\r\n        </h3>\r\n\r\n        <div class=\"mt-4\">\r\n          <label for=\"client\" class=\"block text-sm font-medium text-gray-700\"\r\n            >Client:</label\r\n          >\r\n          <div>\r\n            <!-- Barre de recherche pour filtrer les clients -->\r\n            <input\r\n              type=\"text\"\r\n              v-model=\"clientSearch\"\r\n              placeholder=\"Rechercher un client\"\r\n              class=\"w-full p-2 mb-2 border border-gray-300 rounded-md focus:ring focus:ring-blue-500 focus:border-blue-500\"\r\n            />\r\n\r\n            <!-- Sélecteur de clients -->\r\n            <select\r\n              id=\"client\"\r\n              v-model=\"selectedClientId\"\r\n              @change=\"updateSelectedClient\"\r\n              class=\"w-full p-3 transition duration-150 ease-in-out border border-gray-300 rounded-md focus:ring focus:ring-blue-500 focus:border-blue-500\"\r\n            >\r\n              <option value=\"\">Sélectionnez un client</option>\r\n              <option v-for=\"client in filteredClients\" :key=\"client.id\" :value=\"client.id\">\r\n                {{ client.nom }}\r\n              </option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"mt-4\">\r\n          <label for=\"comment\" class=\"block text-sm font-medium text-gray-700\"\r\n            >Commentaire:</label\r\n          >\r\n          <textarea\r\n            id=\"comment\"\r\n            v-model=\"comment\"\r\n            class=\"w-full p-3 transition duration-150 ease-in-out border border-gray-300 rounded-md focus:ring focus:ring-blue-500 focus:border-blue-500\"\r\n            placeholder=\"Entrez un commentaire\"\r\n          ></textarea>\r\n        </div>\r\n\r\n        <div class=\"flex justify-between mt-4\">\r\n          <div class=\"w-full pr-2\">\r\n            <label for=\"start-date\" class=\"block text-sm font-medium text-gray-700\"\r\n              >Date de début:</label\r\n            >\r\n            <input\r\n              id=\"start-date\"\r\n              type=\"date\"\r\n              v-model=\"startDate\"\r\n              class=\"w-full p-3 transition duration-150 ease-in-out border border-gray-300 rounded-md focus:ring focus:ring-blue-500 focus:border-blue-500\"\r\n            />\r\n          </div>\r\n          <div class=\"w-full pl-2\">\r\n            <label for=\"end-date\" class=\"block text-sm font-medium text-gray-700\"\r\n              >Date de fin:</label\r\n            >\r\n            <input\r\n              id=\"end-date\"\r\n              type=\"date\"\r\n              v-model=\"endDate\"\r\n              class=\"w-full p-3 transition duration-150 ease-in-out border border-gray-300 rounded-md focus:ring focus:ring-blue-500 focus:border-blue-500\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"flex space-x-4\">\r\n          <button\r\n            v-if=\"selectedEvent.id\"\r\n            @click=\"updateEvent\"\r\n            class=\"w-full px-4 py-3 mt-6 text-white transition duration-150 ease-in-out bg-green-500 rounded-md hover:bg-green-600 focus:outline-none focus:ring focus:ring-green-300\"\r\n          >\r\n            Mettre à jour l'intervention\r\n          </button>\r\n\r\n          <button\r\n            v-else\r\n            @click=\"saveEvent\"\r\n            class=\"w-full px-4 py-3 mt-6 text-white transition duration-150 ease-in-out bg-blue-500 rounded-md hover:bg-blue-600 focus:outline-none focus:ring focus:ring-blue-300\"\r\n          >\r\n            Enregistrer l'intervention\r\n          </button>\r\n\r\n          <!-- Button to delete the event -->\r\n          <button\r\n            v-if=\"selectedEvent.id\"\r\n            @click=\"deleteEvent\"\r\n            class=\"w-full px-4 py-3 mt-6 text-white transition duration-150 ease-in-out bg-red-500 rounded-md hover:bg-red-600 focus:outline-none focus:ring focus:ring-red-300\"\r\n          >\r\n            Supprimer l'intervention\r\n          </button>\r\n\r\n          <button\r\n            @click=\"closeEventModal\"\r\n            class=\"w-full px-4 py-3 mt-6 text-white transition duration-150 ease-in-out bg-gray-500 rounded-md hover:bg-gray-600 focus:outline-none focus:ring focus:ring-gray-300\"\r\n          >\r\n            Fermer\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { format } from \"date-fns\";\r\nimport axios from \"axios\";\r\nimport jsPDF from 'jspdf';\r\nimport 'jspdf-autotable';\r\nimport ExcelJS from 'exceljs';\r\nimport { API_URL } from '@/config'; // Importer API_URL\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n  colorMapping: {\r\n      1: { name: 'Client', class: 'bg-orange-400' },\r\n      2: { name: 'Prévision', class: 'bg-yellow-400' }, // Corrigé de 'yellow' à 'yellow-400'\r\n      3: { name: 'Voyage', class: 'bg-sky-400' }, // Corrigé de 'Voyage' à 'Voyage'\r\n      4: { name: 'Férié/Congé', class: 'bg-blue-300' },\r\n      5: { name: 'Formation', class: 'bg-blue-500' },\r\n      6: { name: 'Récupération', class: 'bg-red-400' },\r\n      7: { name: 'Congé maladie', class: 'bg-purple-600' },\r\n      8: { name: 'Université', class: 'bg-sky-600' },\r\n      9: { name: 'Avant Vente', class: 'bg-teal-300' }, // Corrigé de 'teal' à 'teal-300'\r\n      default: { name: 'Inconnu', class: 'bg-blue-400' }\r\n    },\r\n      isExportModalOpen: false,\r\n      currentYear: new Date().getFullYear(),\r\n      currentMonth: new Date().getMonth(),\r\n      monthsOfYear: [\r\n        \"Janvier\",\r\n        \"Février\",\r\n        \"Mars\",\r\n        \"Avril\",\r\n        \"Mai\",\r\n        \"Juin\",\r\n        \"Juillet\",\r\n        \"Août\",\r\n        \"Septembre\",\r\n        \"Octobre\",\r\n        \"Novembre\",\r\n        \"Décembre\",\r\n      ],\r\n      currentDay: new Date().getDate(),\r\n      viewMode: \"year\", //  month or year\r\n      resources: [],\r\n      events: [],\r\n      selectedClientId: \"\",\r\n      clientSearch: \"\", // Barre de recherche pour le filtre\r\n      clients: [], // Assurez-vous que `clients` contient les données de vos clients\r\n      joursFeries: [],\r\n      agences: [],\r\n      bangeResults: [],\r\n      isBANGEModalOpen: false,\r\n      bangeStartDate: \"\",\r\n      bangeEndDate: \"\",\r\n      searchStartDate: \"\",\r\n      searchEndDate: \"\",\r\n      tnfSearchResults: [],\r\n      isEventModalOpen: false,\r\n      selectedEvent: {},\r\n      hoveredEvent: null,\r\n      hoveredDay: null,\r\n      selectedClientColor: \"\",\r\n      comment: \"\",\r\n      startDate: \"\",\r\n      endDate: \"\",\r\n      user_id: null,\r\n      selectedPays: \"\",\r\n    };\r\n  },\r\n  computed: {\r\n    filteredClients() {\r\n      return this.clients.filter((client) =>\r\n        client.nom.toLowerCase().includes(this.clientSearch.toLowerCase())\r\n      );\r\n    },\r\n    displayPeriod() {\r\n      if (this.viewMode === \"month\") {\r\n        const firstDayOfMonth = new Date(this.currentYear, this.currentMonth, 1);\r\n        return format(firstDayOfMonth, \"MMMM yyyy\");\r\n      } else if (this.viewMode === \"year\") {\r\n        const firstDayOfYear = new Date(this.currentYear, 0, 1);\r\n        return format(firstDayOfYear, \"yyyy\");\r\n      } else {\r\n        return `${this.currentYear}`;\r\n      }\r\n    },\r\n    formattedJoursFeries() {\r\n      // Format the public holidays to only include the date in 'yyyy-MM-dd' format\r\n      return this.joursFeries.map((jourFerie) => ({\r\n        date: format(new Date(jourFerie.date_ferie), \"yyyy-MM-dd\"), // Keep the date format\r\n        name: jourFerie.nom_ferie,\r\n      }));\r\n    },\r\n    periodDays() {\r\n      return this.viewMode === \"month\" ? this.getDaysInMonth() : this.getDaysInYear();\r\n    },\r\n    filteredResources() {\r\n      let filtered = this.resources;\r\n\r\n      // Filter by client name\r\n      if (this.clientSearch) {\r\n        // Find resource IDs that have interventions matching the client name\r\n        const matchingResourceIds = new Set(\r\n          this.events\r\n            .filter((event) =>\r\n              event.clientName.toLowerCase().includes(this.clientSearch.toLowerCase())\r\n            )\r\n            .map((event) => event.resourceId)\r\n        );\r\n\r\n        // Filter resources based on matching IDs\r\n        filtered = this.resources.filter((resource) =>\r\n          matchingResourceIds.has(resource.id)\r\n        );\r\n      }\r\n\r\n      // Filter by date range\r\n      if (this.searchStartDate && this.searchEndDate) {\r\n        const startDate = new Date(this.searchStartDate);\r\n        const endDate = new Date(this.searchEndDate);\r\n        filtered = filtered.filter((resource) => {\r\n          const tnfDays = this.getTNFDaysInPeriod(resource, startDate, endDate);\r\n          return tnfDays.length > 0;\r\n        });\r\n      }\r\n\r\n      // Filter by selected agency\r\n      if (this.selectedPays) {\r\n        filtered = filtered.filter(\r\n          (resource) => resource.agence && resource.agence.pays === this.selectedPays\r\n        );\r\n      }\r\n\r\n      return filtered;\r\n    },\r\n    // Nouvelle propriété calculée pour récupérer les événements par jour et ressource\r\n    filteredEventsByDay() {\r\n      const filteredEvents = {};\r\n\r\n      this.filteredResources.forEach((resource) => {\r\n        filteredEvents[resource.name] = {};\r\n\r\n        const days =\r\n          this.viewMode === \"month\"\r\n            ? this.getDaysInMonth()\r\n            : this.getDaysInYear().flatMap((month) => month.days);\r\n\r\n        days.forEach((day) => {\r\n          const dayDate = new Date(\r\n            this.currentYear,\r\n            this.viewMode === \"month\" ? this.currentMonth : 0,\r\n            typeof day === \"number\" ? day : day.day\r\n          );\r\n\r\n          filteredEvents[resource.name][day] = this.events.filter(\r\n            (event) =>\r\n              event.resource === resource.name && this.isEventOnDay(event, dayDate)\r\n          );\r\n        });\r\n      });\r\n\r\n      return filteredEvents;\r\n    },\r\n     statisticsByColor() {\r\n    return this.calculateStatisticsByColor();\r\n  },\r\n  },\r\n  watch: {\r\n    searchStartDate() {\r\n      this.updateView();\r\n    },\r\n    searchEndDate() {\r\n      this.updateView();\r\n    },\r\n    clientSearch() {\r\n      this.updateView();\r\n    },\r\n    selectedPays() {\r\n      this.fetchJoursFeries();\r\n      this.fetchResourcesAndEvents();\r\n    },\r\n  },\r\n  mounted() {\r\n    this.fetchResourcesAndEvents();\r\n    this.fetchClients();\r\n    this.fetchJoursFeries();\r\n    this.fetchAgences();\r\n  },\r\n  methods: {\r\n    \r\n    openExportModal() {\r\n      this.isExportModalOpen = true;\r\n    },\r\n    closeExportModal() {\r\n      this.isExportModalOpen = false;\r\n      this.endDate = \"\";\r\n      this.startDate = \"\";\r\n    },\r\n    exportToXLSX() {\r\n      const workbook = new ExcelJS.Workbook();\r\n      const worksheet = workbook.addWorksheet('Interventions');\r\n\r\n      // Définir les colonnes\r\n      worksheet.columns = [\r\n        { header: 'Numero', key: 'Numero', width: 10 },\r\n        { header: 'Ressource', key: 'Ressource', width: 20 },\r\n        { header: 'Date de debut', key: 'Date_de_debut', width: 20 },\r\n        { header: 'Date de fin', key: 'Date_de_fin', width: 20 },\r\n        { header: 'Client', key: 'Client', width: 20 },\r\n        { header: 'Commentaire', key: 'Commentaire', width: 30 },\r\n        { header: 'Abbreviation', key: 'Abbreviation', width: 15 }\r\n      ];\r\n\r\n      // Vérifier si les dates sont sélectionnées\r\n      let filteredEvents = this.events;\r\n      if (this.startDate && this.endDate) {\r\n        filteredEvents = this.events.filter(event => {\r\n          const eventStartDate = new Date(event.startDate);\r\n          const eventEndDate = new Date(event.endDate);\r\n          const start = new Date(this.startDate);\r\n          const end = new Date(this.endDate);\r\n          return eventStartDate >= start && eventEndDate <= end;\r\n        });\r\n      }\r\n\r\n      // Ajouter les données\r\n      filteredEvents.forEach((event, index) => {\r\n        worksheet.addRow({\r\n          Numero: index + 1,\r\n          Ressource: event.resource,\r\n          Date_de_debut: event.startDate,\r\n          Date_de_fin: event.endDate,\r\n          Client: event.clientName,\r\n          Commentaire: event.name,\r\n          Abbreviation: event.clientAbbreviation\r\n        });\r\n      });\r\n\r\n      // Styliser l'entête avec un gradient violet et rose\r\n      const headerRow = worksheet.getRow(1);\r\n      headerRow.eachCell((cell) => {\r\n        cell.fill = {\r\n          type: 'gradient',\r\n          gradient: 'angle',\r\n          degree: 0,\r\n          stops: [\r\n            { position: 0, color: { argb: 'FF69B4' } }, // Rose\r\n            { position: 1, color: { argb: '800080' } } // Violet\r\n          ]\r\n        };\r\n        cell.font = { color: { argb: 'FFFFFF' }, bold: true };\r\n        cell.alignment = { horizontal: 'center', vertical: 'middle' };\r\n      });\r\n\r\n      // Obtenir la date actuelle\r\n      const currentDate = new Date().toLocaleDateString().replace(/\\//g, '-');\r\n\r\n      // Enregistrer le fichier avec la date d'exportation dans le nom\r\n      workbook.xlsx.writeBuffer().then((data) => {\r\n        const blob = new Blob([data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });\r\n        const link = document.createElement('a');\r\n        link.href = URL.createObjectURL(blob);\r\n        link.download = `Staffings_${currentDate}.xlsx`;\r\n        link.click();\r\n        URL.revokeObjectURL(link.href);\r\n      });\r\n\r\n      // Fermer le modal après l'exportation\r\n      this.closeExportModal();\r\n    },\r\n    exportToPDF() {\r\n      // Définir le format A4\r\n      const doc = new jsPDF({\r\n        orientation: 'portrait',\r\n        unit: 'mm',\r\n        format: [210, 297]\r\n      });\r\n\r\n      // Définir les colonnes et les données\r\n      const columns = [\r\n        { header: 'Numero', dataKey: 'Numero' },\r\n        { header: 'Ressource', dataKey: 'Ressource' },\r\n        { header: 'Date de debut', dataKey: 'Date_de_debut' },\r\n        { header: 'Date de fin', dataKey: 'Date_de_fin' },\r\n        { header: 'Client', dataKey: 'Client' },\r\n        { header: 'Commentaire', dataKey: 'Commentaire' },\r\n        { header: 'Abbreviation', dataKey: 'Abbreviation' }\r\n      ];\r\n\r\n      // Vérifier si les dates sont sélectionnées\r\n      let filteredEvents = this.events;\r\n      if (this.startDate && this.endDate) {\r\n        filteredEvents = this.events.filter(event => {\r\n          const eventStartDate = new Date(event.startDate);\r\n          const eventEndDate = new Date(event.endDate);\r\n          const start = new Date(this.startDate);\r\n          const end = new Date(this.endDate);\r\n          return eventStartDate >= start && eventEndDate <= end;\r\n        });\r\n      }\r\n\r\n      const data = filteredEvents.map((event, index) => ({\r\n        Numero: index + 1,\r\n        Ressource: event.resource,\r\n        Date_de_debut: event.startDate,\r\n        Date_de_fin: event.endDate,\r\n        Client: event.clientName,\r\n        Commentaire: event.name,\r\n        Abbreviation: event.clientAbbreviation\r\n      }));\r\n\r\n      // Ajouter le tableau au PDF\r\n      doc.autoTable({\r\n        head: [columns.map(col => col.header)],\r\n        body: data.map(row => columns.map(col => row[col.dataKey])),\r\n        startY: 20,\r\n        styles: {\r\n          fillColor: [240, 240, 240], // Blanc légèrement gris\r\n          textColor: [0, 0, 0], // Noir\r\n          fontStyle: 'normal',\r\n          halign: 'center',\r\n          valign: 'middle',\r\n          cellPadding: 5\r\n        },\r\n        headStyles: {\r\n          fillColor: [128, 0, 128], // Violet\r\n          textColor: [255, 255, 255],\r\n          fontStyle: 'bold',\r\n          halign: 'center',\r\n          valign: 'middle',\r\n          cellPadding: 5\r\n        }\r\n      });\r\n\r\n      // Obtenir la date actuelle\r\n      const currentDate = new Date().toLocaleDateString().replace(/\\//g, '-');\r\n\r\n      // Enregistrer le PDF avec la date d'exportation dans le nom\r\n      doc.save(`Staffings_${currentDate}.pdf`);\r\n\r\n      // Fermer le modal après l'exportation\r\n      this.closeExportModal();\r\n    },\r\n    async fetchAgences() {\r\n      try {\r\n        const response = await axios.get(`${API_URL}/agences`, {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\r\n          },\r\n        });\r\n        this.agences = response.data.agences;\r\n      } catch (error) {\r\n        console.error(\"Erreur lors de la récupération des agences:\", error);\r\n      }\r\n    },\r\n    filterInterventionsByClientName(clientName) {\r\n      const lowerCaseClientName = clientName.toLowerCase();\r\n      return this.events.filter((event) =>\r\n        event.clientName.toLowerCase().includes(lowerCaseClientName)\r\n      );\r\n    },\r\n    calculateBANGE(startDate, endDate) {\r\n      const start = new Date(startDate);\r\n      const end = new Date(endDate);\r\n      let totalBANGE = 0;\r\n      let currentWeekStart = new Date(start);\r\n\r\n      while (currentWeekStart <= end) {\r\n        const weekEnd = new Date(currentWeekStart);\r\n        weekEnd.setDate(currentWeekStart.getDate() + 6);\r\n\r\n        let totalTNF = 0;\r\n        let workingDays = 0;\r\n\r\n        for (\r\n          let d = new Date(currentWeekStart);\r\n          d <= weekEnd;\r\n          d.setDate(d.getDate() + 1)\r\n        ) {\r\n          const { isWeekend } = this.isWeekend(d.getDate(), d.getMonth());\r\n          const isHoliday = this.isJourFerie(d.getDate(), d.getMonth());\r\n\r\n          if (isHoliday) {\r\n            continue;\r\n          }\r\n\r\n          if (isWeekend) {\r\n            console.log(\"holiday\");\r\n          } else {\r\n            workingDays++;\r\n\r\n            this.resources.forEach((resource) => {\r\n              const events = this.getEventsForMonth(\r\n                resource.name,\r\n                d.getMonth(),\r\n                d.getDate()\r\n              );\r\n              if (!events || events.length === 0) {\r\n                totalTNF++;\r\n              }\r\n            });\r\n          }\r\n        }\r\n\r\n        const etp = workingDays > 0 ? Math.min(workingDays, 5) : 0; // Limite à 5 jours max\r\n        const weeklyBANGE = etp > 0 ? (totalTNF / etp).toFixed(1) : 0;\r\n        totalBANGE += parseFloat(weeklyBANGE);\r\n\r\n        currentWeekStart.setDate(currentWeekStart.getDate() + 7); // Passe à la semaine suivante\r\n      }\r\n\r\n      return totalBANGE.toFixed(1); // Retourne le total formaté\r\n    },\r\n    calculateAndDisplayBANGE() {\r\n      if (this.bangeStartDate && this.bangeEndDate) {\r\n        const bangeResult = this.calculateBANGE(this.bangeStartDate, this.bangeEndDate);\r\n        this.bangeResults.push({\r\n          date: `${this.bangeStartDate} - ${this.bangeEndDate}`,\r\n          bange: bangeResult,\r\n        });\r\n        this.isBANGEModalOpen = true;\r\n      } else {\r\n        alert(\"Veuillez sélectionner une date de début et une date de fin.\");\r\n      }\r\n    },\r\n    closeBANGEModal() {\r\n      this.isBANGEModalOpen = false;\r\n      this.bangeStartDate = \"\";\r\n      this.bangeEndDate = \"\";\r\n      this.bangeResults = [];\r\n    },\r\n    getDayAbbreviation(date) {\r\n      const days = [\"dim\", \"lun\", \"mar\", \"mer\", \"jeu\", \"ven\", \"sam\"];\r\n      return days[date.getDay()];\r\n    },\r\n    isWednesday(day, monthIndex) {\r\n      const date = new Date(this.currentYear, monthIndex, day);\r\n      return date.getDay() === 3; // 3 représente mercredi (0 = dimanche, 1 = lundi, etc.)\r\n    },\r\n    // Modifiez la méthode getWeeklyBANGE pour prendre en compte le monthIndex\r\n    getWeeklyBANGE(day, monthIndex = null) {\r\n      // Détermine la date de la semaine à partir du jour donné\r\n      const initialDate = new Date(\r\n        this.currentYear,\r\n        monthIndex !== null ? monthIndex : this.currentMonth,\r\n        day\r\n      );\r\n\r\n      // Ajuste le début de la semaine au lundi\r\n      const weekStart = new Date(initialDate);\r\n      const dayOfWeek = weekStart.getDay(); // 0 = Dimanche, 1 = Lundi, ..., 6 = Samedi\r\n      const offsetToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // Ajustement vers le lundi\r\n      weekStart.setDate(weekStart.getDate() + offsetToMonday);\r\n\r\n      // Fixe la fin de la semaine au vendredi (4 jours après lundi)\r\n      const weekEnd = new Date(weekStart);\r\n      weekEnd.setDate(weekStart.getDate() + 4);\r\n\r\n      let totalTNF = 0; // Compteur des jours sans événements\r\n      let workingDays = 0; // Compteur des jours ouvrables\r\n\r\n      // Parcourt chaque jour de la semaine (lundi à vendredi)\r\n      for (let d = new Date(weekStart); d <= weekEnd; d.setDate(d.getDate() + 1)) {\r\n        const isHoliday = this.isJourFerie(d.getDate(), d.getMonth()); // Vérifie si le jour est férié\r\n\r\n        if (isHoliday) {\r\n          // Ignore les jours fériés\r\n          continue;\r\n        }\r\n\r\n        // Tous les jours de lundi à vendredi sont considérés ouvrables ici\r\n        workingDays++; // Incrémente les jours ouvrables\r\n\r\n        // Vérifie les événements pour chaque ressource\r\n        this.resources.forEach((resource) => {\r\n          const events = this.getEventsForMonth(\r\n            resource.name,\r\n            d.getMonth(),\r\n            d.getDate()\r\n          );\r\n\r\n          if (!events || events.length === 0) {\r\n            // Si aucun événement trouvé, incrémente TNF\r\n            totalTNF++;\r\n          }\r\n        });\r\n      }\r\n\r\n      // Calcule l'ETP (équivalent temps plein), limité à un maximum de 5 jours par semaine\r\n      const etp = workingDays > 0 ? Math.min(workingDays, 5) : 0;\r\n\r\n      // Calcule le ratio BANGE pour la semaine\r\n      const bange = etp > 0 ? (totalTNF / etp).toFixed(1) : 0;\r\n\r\n      // Retourne le BANGE pour la semaine\r\n      return { bange };\r\n    },\r\n    // Nouvelle méthode pour calculer le BANGE mensuel\r\n    getMonthlyBANGE() {\r\n      const start = new Date(this.currentYear, this.currentMonth, 1);\r\n      const end = new Date(this.currentYear, this.currentMonth + 1, 0);\r\n      let totalBANGE = 0;\r\n      let currentWeekStart = new Date(start);\r\n\r\n      while (currentWeekStart <= end) {\r\n        const weekEnd = new Date(currentWeekStart);\r\n        weekEnd.setDate(currentWeekStart.getDate() + 6);\r\n\r\n        let totalTNF = 0;\r\n        let workingDays = 0;\r\n\r\n        for (\r\n          let d = new Date(currentWeekStart);\r\n          d <= weekEnd;\r\n          d.setDate(d.getDate() + 1)\r\n        ) {\r\n          const dayOfWeek = d.getDay();\r\n          if (\r\n            dayOfWeek !== 0 &&\r\n            dayOfWeek !== 6 &&\r\n            !this.isJourFerie(d.getDate(), d.getMonth())\r\n          ) {\r\n            workingDays++;\r\n            this.resources.forEach((resource) => {\r\n              const events = this.getEventsForMonth(\r\n                resource.name,\r\n                d.getMonth(),\r\n                d.getDate()\r\n              );\r\n              if (!events || events.length === 0) {\r\n                totalTNF++;\r\n              }\r\n            });\r\n          }\r\n        }\r\n\r\n        const etp = workingDays > 0 ? Math.min(workingDays, 5) : 0;\r\n        const weeklyBANGE = etp > 0 ? (totalTNF / etp).toFixed(1) : 0;\r\n        totalBANGE += parseFloat(weeklyBANGE);\r\n\r\n        currentWeekStart.setDate(currentWeekStart.getDate() + 7);\r\n      }\r\n\r\n      return totalBANGE.toFixed(1);\r\n    },\r\n    getJourFerieName(day, monthIndex = null) {\r\n      const date = new Date(\r\n        this.currentYear,\r\n        monthIndex !== null ? monthIndex : this.currentMonth,\r\n        typeof day === \"number\" ? day : new Date(day).getDate()\r\n      );\r\n      const formattedDate = format(date, \"yyyy-MM-dd\");\r\n      const jourFerie = this.formattedJoursFeries.find(\r\n        (jour) => jour.date === formattedDate\r\n      );\r\n      return jourFerie ? jourFerie.name : \"Férié\";\r\n    },\r\n    isJourFerie(day, monthIndex = null) {\r\n      const date = new Date(\r\n        this.currentYear,\r\n        monthIndex !== null ? monthIndex : this.currentMonth,\r\n        typeof day === \"number\" ? day : new Date(day).getDate()\r\n      );\r\n      const formattedDate = format(date, \"yyyy-MM-dd\");\r\n\r\n      const isHoliday = this.formattedJoursFeries.some(\r\n        (jour) => jour.date === formattedDate\r\n      );\r\n\r\n      return isHoliday;\r\n    },\r\n    calculateBusinessDays(startDate, endDate) {\r\n      let count = 0;\r\n      const currentDate = new Date(startDate);\r\n\r\n      while (currentDate <= endDate) {\r\n        const dayOfWeek = currentDate.getDay();\r\n        if (dayOfWeek !== 0 && dayOfWeek !== 6) {\r\n          count++;\r\n        }\r\n        currentDate.setDate(currentDate.getDate() + 1);\r\n      }\r\n\r\n      return count;\r\n    },\r\n    showComment(event, day) {\r\n      this.hoveredEvent = event;\r\n      this.hoveredDay = day;\r\n    },\r\n    hideComment() {\r\n      this.hoveredEvent = null;\r\n      this.hoveredDay = null;\r\n    },\r\n    // Remplacer la méthode searchTNF par updateView\r\n    updateView() {\r\n      if (this.searchStartDate && this.searchEndDate) {\r\n        const startDate = new Date(this.searchStartDate);\r\n        this.currentYear = startDate.getFullYear();\r\n        this.currentMonth = startDate.getMonth();\r\n      }\r\n    },\r\n    clearDateFilters() {\r\n      this.searchStartDate = \"\";\r\n      this.searchEndDate = \"\";\r\n      this.updateView();\r\n    },\r\n    getTNFDaysInPeriod(resource, startDate, endDate) {\r\n      const tnfDays = [];\r\n      const resourceEvents = this.events.filter(\r\n        (event) => event.resource === resource.name\r\n      );\r\n\r\n      for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {\r\n        // Ignorer les week-ends et les jours fériés\r\n        if (\r\n          this.isWeekend(d.getDate(), d.getMonth()).isWeekend ||\r\n          this.isJourFerie(d.getDate(), d.getMonth())\r\n        ) {\r\n          continue;\r\n        }\r\n\r\n        const eventsOnDay = resourceEvents.filter((event) => this.isEventOnDay(event, d));\r\n        if (eventsOnDay.length === 0) {\r\n          tnfDays.push(new Date(d.getFullYear(), d.getMonth(), d.getDate()));\r\n        }\r\n      }\r\n\r\n      return tnfDays;\r\n    },\r\n    isHighlightedTNF(resourceName, day, monthIndex) {\r\n      if (!this.searchStartDate || !this.searchEndDate) return false;\r\n\r\n      const resource = this.resources.find((r) => r.name === resourceName);\r\n      if (!resource) return false;\r\n\r\n      const date = new Date(\r\n        this.currentYear,\r\n        monthIndex !== undefined ? monthIndex : this.currentMonth,\r\n        day\r\n      );\r\n      const startDate = new Date(this.searchStartDate);\r\n      const endDate = new Date(this.searchEndDate);\r\n\r\n      // Exclure le jour s'il est en dehors de la plage ou s'il est un jour férié\r\n      if (date < startDate || date > endDate || this.isJourFerie(day, monthIndex)) return false;\r\n\r\n      const tnfDays = this.getTNFDaysInPeriod(resource, startDate, endDate);\r\n\r\n      return tnfDays.some(\r\n        (tnfDay) =>\r\n          tnfDay.getDate() === date.getDate() &&\r\n          tnfDay.getMonth() === date.getMonth() &&\r\n          tnfDay.getFullYear() === date.getFullYear()\r\n      );\r\n    },\r\n    async fetchJoursFeries() {\r\n      try {\r\n        const response = await axios.get(`${API_URL}/jours-feries`, {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\r\n          },\r\n        });\r\n        this.joursFeries = response.data.filter(\r\n          (jour) =>\r\n            this.selectedPays === \"\" ||\r\n            (jour.agence && jour.agence.pays === this.selectedPays)\r\n        );\r\n      } catch (error) {\r\n        console.error(\"Erreur lors de la récupération des jours fériés:\", error);\r\n      }\r\n    },\r\n    async fetchClients() {\r\n      try {\r\n        const response = await axios.get(`${API_URL}/clients`, {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\r\n          },\r\n        });\r\n        this.clients = response.data;\r\n      } catch (error) {\r\n        console.error(\"Erreur lors de la récupération des clients:\", error);\r\n      }\r\n    },\r\n    updateSelectedClient() {\r\n      const selectedClient = this.clients.find(\r\n        (client) => client.id === this.selectedClientId\r\n      );\r\n      if (selectedClient) {\r\n        this.selectedClientColor = selectedClient.color;\r\n      }\r\n    },\r\n    async saveEvent() {\r\n      try {\r\n        await axios.post(\r\n          `${API_URL}/interventions`,\r\n          {\r\n            user_id: this.user_id,\r\n            client_id: this.selectedClientId, // Assurez-vous d'utiliser l'ID du client ici\r\n            commentaire: this.comment,\r\n            date_debut: this.startDate,\r\n            date_fin: this.endDate,\r\n            color: this.selectedClientColor,\r\n          },\r\n          {\r\n            headers: {\r\n              \"Content-Type\": \"application/json\",\r\n              Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\r\n            },\r\n          }\r\n        );\r\n\r\n        await this.fetchResourcesAndEvents();\r\n        this.closeEventModal();\r\n      } catch (error) {\r\n        console.error(\"Erreur lors de la sauvegarde de l'événement:\", error);\r\n        if (error.response) {\r\n          console.error(\"Détails de l'erreur:\", error.response.data);\r\n          // Affichez un message d'erreur utilisateur ici si nécessaire\r\n        }\r\n      }\r\n    },\r\n    async updateEvent() {\r\n      try {\r\n        await axios.post(\r\n          // Utilisez PUT pour les mises à jour\r\n          `${API_URL}/interventions/${this.selectedEvent.id}`,\r\n          {\r\n            user_id: this.user_id,\r\n            client_id: this.selectedClientId, // Assurez-vous d'utiliser l'ID du client ici\r\n            commentaire: this.comment,\r\n            date_debut: this.startDate,\r\n            date_fin: this.endDate,\r\n            color: this.selectedClientColor,\r\n          },\r\n          {\r\n            headers: {\r\n              \"Content-Type\": \"application/json\",\r\n              Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\r\n            },\r\n          }\r\n        );\r\n\r\n        await this.fetchResourcesAndEvents();\r\n        this.closeEventModal();\r\n      } catch (error) {\r\n        console.error(\"Erreur lors de la mise à jour de l'événement:\", error);\r\n        if (error.response) {\r\n          console.error(\"Détails de l'erreur:\", error.response.data);\r\n          // Affichez un message d'erreur utilisateur ici si nécessaire\r\n        }\r\n      }\r\n    },\r\n    selectClient(clientId) {\r\n      const client = this.clients.find((c) => c.id === clientId);\r\n      if (client) {\r\n        this.selectedClient = client.nom;\r\n        this.selectedClientId = client.id;\r\n        this.selectedClientColor = client.color; // Assurez-vous que cette ligne est présente\r\n      } else {\r\n        this.selectedClient = null;\r\n        this.selectedClientId = null;\r\n        this.selectedClientColor = \"\";\r\n      }\r\n    },\r\n    openEventModal(day, resourceName, monthIndex = null) {\r\n      let selectedDate;\r\n\r\n      if (monthIndex !== null) {\r\n        selectedDate = new Date(this.currentYear, monthIndex, day);\r\n      } else {\r\n        selectedDate = new Date(this.currentYear, this.currentMonth, day);\r\n      }\r\n\r\n      if (!isNaN(selectedDate.getTime())) {\r\n        const headerDate = format(selectedDate, \"yyyy-MM-dd\");\r\n        this.startDate = headerDate;\r\n\r\n        const resource = this.resources.find((r) => r.name === resourceName);\r\n\r\n        if (resource) {\r\n          this.selectedEvent = {\r\n            resourceName,\r\n            resourceId: resource.id,\r\n            day: this.startDate,\r\n          };\r\n          this.user_id = resource.id;\r\n\r\n          const events =\r\n            monthIndex !== null\r\n              ? this.getEventsForMonth(resourceName, monthIndex, day)\r\n              : this.filteredEventsByDay[resourceName][day];\r\n\r\n          const event = events && events[0];\r\n\r\n          if (event) {\r\n            const intervention = resource.interventions.find((i) => i.id === event.id);\r\n            if (intervention) {\r\n              this.selectedClientId = intervention.client_id; // L'ID du client\r\n              this.selectedClient = intervention.client_name; // Le nom du client\r\n              this.comment = intervention.commentaire;\r\n              this.startDate = format(new Date(intervention.date_debut), \"yyyy-MM-dd\");\r\n              this.endDate = format(new Date(intervention.date_fin), \"yyyy-MM-dd\");\r\n              (this.selectedClientColor = intervention.client_color),\r\n                (this.selectedEvent.id = intervention.id); // Marquer comme événement existant\r\n            }\r\n          } else {\r\n            // Réinitialiser pour un nouvel événement\r\n            this.selectedClient = null;\r\n            this.selectedClientId = null;\r\n            this.comment = \"\";\r\n            this.startDate = headerDate;\r\n            this.endDate = \"\";\r\n            this.selectedClientColor = \"\"; // Valeur par défaut\r\n            this.selectedEvent.id = null; // Marquer comme nouvel événement\r\n          }\r\n\r\n          this.isEventModalOpen = true; // Ouvrir le modal\r\n        }\r\n      }\r\n    },\r\n    async deleteEvent() {\r\n      try {\r\n        await axios.delete(`${API_URL}/interventions/${this.selectedEvent.id}`, {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\r\n          },\r\n        });\r\n\r\n        await this.fetchResourcesAndEvents();\r\n        this.closeEventModal();\r\n      } catch (error) {\r\n        console.error(\"Erreur lors de la suppression de l'événement:\", error);\r\n        if (error.response) {\r\n          console.error(\"Détails de l'erreur:\", error.response.data);\r\n        }\r\n      }\r\n    },\r\n    closeEventModal() {\r\n      this.isEventModalOpen = false;\r\n      this.selectedEvent = {};\r\n      this.selectedClient = null;\r\n      this.comment = \"\";\r\n      this.startDate = \"\";\r\n      this.endDate = \"\";\r\n      this.selectedClientColor = \"\";\r\n    },\r\n    resetToToday() {\r\n      const today = new Date();\r\n      this.currentYear = today.getFullYear();\r\n      this.currentMonth = today.getMonth();\r\n      this.currentDay = today.getDate();\r\n    },\r\n    prevPeriod() {\r\n      if (this.viewMode === \"month\") {\r\n        this.currentMonth--;\r\n        if (this.currentMonth < 0) {\r\n          this.currentMonth = 11;\r\n          this.currentYear--;\r\n        }\r\n      } else {\r\n        this.currentYear--;\r\n      }\r\n      this.fetchJoursFeries(); // Ajoutez cette ligne\r\n    },\r\n    nextPeriod() {\r\n      if (this.viewMode === \"month\") {\r\n        this.currentMonth++;\r\n        if (this.currentMonth > 11) {\r\n          this.currentMonth = 0;\r\n          this.currentYear++;\r\n        }\r\n      } else {\r\n        this.currentYear++;\r\n      }\r\n      this.fetchJoursFeries(); // Ajoutez cette ligne\r\n    },\r\n    getDayLabel(index, day) {\r\n      const dayDate = new Date(this.currentYear, this.currentMonth, day);\r\n      return format(dayDate, \"EEE dd\");\r\n    },\r\n    getDaysInMonth(monthIndex = null) {\r\n      const month = monthIndex !== null ? monthIndex : this.currentMonth;\r\n      const daysInMonth = new Date(this.currentYear, month + 1, 0).getDate();\r\n      return Array.from({ length: daysInMonth }, (_, i) => i + 1);\r\n    },\r\n    getDaysInYear() {\r\n      const months = [];\r\n      for (let month = 0; month < 12; month++) {\r\n        const daysInMonth = new Date(this.currentYear, month + 1, 0).getDate();\r\n        const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);\r\n        months.push({\r\n          month: format(new Date(this.currentYear, month), \"MMMM\"),\r\n          days,\r\n        });\r\n      }\r\n      return months;\r\n    },\r\n    isWeekend(day, month = this.currentMonth) {\r\n      const date = new Date(this.currentYear, month, day);\r\n      const dayOfWeek = date.getDay();\r\n      return { isWeekend: dayOfWeek === 0 || dayOfWeek === 6, dayOfWeek };\r\n    },\r\n    isEventOnDay(event, day) {\r\n      const eventStart = new Date(event.startDate);\r\n      const eventEnd = new Date(event.endDate);\r\n      const dayOfWeek = day.getDay();\r\n      const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;\r\n\r\n      const dayDate = new Date(day.getFullYear(), day.getMonth(), day.getDate());\r\n      const eventStartDate = new Date(\r\n        eventStart.getFullYear(),\r\n        eventStart.getMonth(),\r\n        eventStart.getDate()\r\n      );\r\n      const eventEndDate = new Date(\r\n        eventEnd.getFullYear(),\r\n        eventEnd.getMonth(),\r\n        eventEnd.getDate()\r\n      );\r\n\r\n      if (isWeekend) {\r\n        // Pour les week-ends, afficher uniquement les événements qui commencent un week-end\r\n        return (\r\n          (eventStart.getDay() === 0 || eventStart.getDay() === 6) &&\r\n          dayDate >= eventStartDate &&\r\n          dayDate <= eventEndDate\r\n        );\r\n      } else {\r\n        // Pour les jours de semaine, afficher uniquement les événements qui commencent un jour de semaine\r\n        return (\r\n          eventStart.getDay() !== 0 &&\r\n          eventStart.getDay() !== 6 &&\r\n          dayDate >= eventStartDate &&\r\n          dayDate <= eventEndDate\r\n        );\r\n      }\r\n    },\r\n    getEventsForMonth(resourceName, monthIndex, day) {\r\n      const date = new Date(this.currentYear, monthIndex, day);\r\n      return this.events.filter(\r\n        (event) => event.resource === resourceName && this.isEventOnDay(event, date)\r\n      );\r\n    },\r\n    async fetchResourcesAndEvents() {\r\n      try {\r\n        const response = await axios.get(`${API_URL}/interventions`, {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\r\n          },\r\n        });\r\n        const data = response.data;\r\n\r\n        this.resources = data.map((user) => ({\r\n          id: user.id,\r\n          name: user.name,\r\n          agence: user.agence,\r\n          interventions: user.interventions,\r\n        }));\r\n\r\n        this.events = data.flatMap((user) =>\r\n          user.interventions.map((intervention) => ({\r\n            id: intervention.id,\r\n            name: intervention.commentaire,\r\n            startDate: intervention.date_debut,\r\n            endDate: intervention.date_fin,\r\n            resource: user.name,\r\n            color: intervention.client_color,\r\n            resourceId: user.id,\r\n            clientAbbreviation: intervention.client_abbreviation,\r\n            clientName: intervention.client_name,\r\n          }))\r\n        );\r\n\r\n        // Filtrer les utilisateurs et les jours fériés en fonction de l'agence sélectionnée\r\n        if (this.selectedPays) {\r\n          this.resources = this.resources.filter(\r\n            (resource) => resource.agence && resource.agence.pays === this.selectedPays\r\n          );\r\n          this.joursFeries = this.joursFeries.filter(\r\n            (jour) => jour.agence && jour.agence.pays === this.selectedPays\r\n          );\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Erreur lors de la récupération des données:\", error);\r\n      }\r\n    },\r\n  calculateStatisticsByColor() {\r\n    const statistics = {};\r\n    let startDate, endDate;\r\n\r\n    if (this.viewMode === 'month') {\r\n      startDate = new Date(this.currentYear, this.currentMonth, 1);\r\n      endDate = new Date(this.currentYear, this.currentMonth + 1, 0);\r\n    } else if (this.viewMode === 'year') {\r\n      startDate = new Date(this.currentYear, 0, 1);\r\n      endDate = new Date(this.currentYear, 11, 31);\r\n    }\r\n\r\n    this.events.forEach(event => {\r\n      const eventStartDate = new Date(event.startDate);\r\n      const eventEndDate = new Date(event.endDate);\r\n\r\n      if (eventStartDate >= startDate && eventEndDate <= endDate) {\r\n        const clientColor = this.getClientColor(event.color);\r\n        const clientName = this.getColorName(clientColor);\r\n\r\n        if (!statistics[clientColor]) {\r\n          statistics[clientColor] = { name: clientName, count: 0 };\r\n        }\r\n        statistics[clientColor].count++;\r\n      }\r\n    });\r\n\r\n    return statistics;\r\n  },\r\n   getClientColor(color) {\r\n    if (!color || typeof color !== \"number\") {\r\n      return this.colorMapping.default.class; // Couleur par défaut si la couleur n'est pas définie ou invalide\r\n    }\r\n    return this.colorMapping[color] ? this.colorMapping[color].class : this.colorMapping.default.class;\r\n  },\r\n\r\n   getColorName(color) {\r\n    if (!color || typeof color !== \"number\") {\r\n      return this.colorMapping.default.name; // Nom par défaut si la couleur n'est pas définie ou invalide\r\n    }\r\n    return this.colorMapping[color] ? this.colorMapping[color].name : this.colorMapping.default.name;\r\n  },\r\n  },\r\n};\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.relative {\r\n  position: relative;\r\n}\r\n\r\n.absolute {\r\n  position: absolute;\r\n}\r\n\r\n/* Ajoutez ces styles pour une meilleure apparence du commentaire */\r\n.absolute {\r\n  max-width: 200px;\r\n  word-wrap: break-word;\r\n  z-index: 100;\r\n}\r\n.tnf-event {\r\n  width: 20px; /* ajuster la largeur pour qu'elle corresponde à la journée */\r\n  max-width: 20px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}